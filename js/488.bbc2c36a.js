"use strict";(self["webpackChunkwebgis"]=self["webpackChunkwebgis"]||[]).push([[488],{2567:function(e,t,r){r.r(t),r.d(t,{default:function(){return X}});var n=r(3396);const a={id:"cesiumContainer"};function i(e,t,r,i,o,s){return(0,n.wg)(),(0,n.iD)("div",a)}var o=r(2588),s=r(1584),u=r(4313),d=r(1845),c=r(3822),m=r(4826),f=r(4081),l=r(5598),p=r(8798),h=r(6114),g=r(2761),x=r(938),E=r(4285);const T={FLOAT:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",MAT2:"mat2",MAT3:"mat2",MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"};var _=Object.freeze(T);r(7658),r(3408),r(4590);function v(e,t,r){const n=new Uint8ClampedArray(e.buffer),a=new ImageData(n,t,r),i=document.createElement("canvas");return i.width=t,i.height=r,i.getContext("2d").putImageData(a,0,0),i}var b=v,C=r(4680),y=r(1746),M=r(416),Z=r(6539),w=r(7831),S=r(6816);function I(){this._defaultTexture=void 0,this._textures={},this._loadedImages=[],this._lastUpdatedFrame=-1}function A(e,t,r){r.resource.fetchImage().then((function(n){e._loadedImages.push({id:t,image:n,textureUniform:r})})).catch((function(){const r=e._textures[t];(0,h.Z)(r)&&r!==e._defaultTexture&&r.destroy(),e._textures[t]=e._defaultTexture}))}function P(e,t,r){const{id:n,textureUniform:a,image:i}=t,o=r.webgl2?R(a,i,r):V(a,i,r),s=e._textures[n];(0,h.Z)(s)&&s!==r.defaultTexture&&s.destroy(),e._textures[n]=o}function R(e,t,r){const{typedArray:n,sampler:a}=e,i=(0,h.Z)(n)?O(e,r):new Z.Z({context:r,source:t,sampler:a});return D(a)&&i.generateMipmap(),i}function V(e,t,r){const{typedArray:n,sampler:a}=e,i=D(a),o=a.wrapS===S.Z.REPEAT||a.wrapS===S.Z.MIRRORED_REPEAT||a.wrapT===S.Z.REPEAT||a.wrapT===S.Z.MIRRORED_REPEAT,{width:s,height:u}=(0,h.Z)(n)?e:t,d=[s,u].every(C.Z.isPowerOfTwo),c=(i||o)&&!d;if(!c)return R(e,t,r);if(!(0,h.Z)(n)){const n=(0,y.Z)(t);return R(e,n,r)}if(e.pixelDatatype===M.Z.UNSIGNED_BYTE){const e=b(n,s,u),t=(0,y.Z)(e);return R({sampler:a},t,r)}return i?console.warn("Texture requires resizing for mipmaps but pixelDataType cannot be resized. The texture may be rendered incorrectly."):o&&console.warn("Texture requires resizing for wrapping but pixelDataType cannot be resized. The texture may be rendered incorrectly."),O(e,r)}function D(e){return[w.Z.NEAREST_MIPMAP_NEAREST,w.Z.NEAREST_MIPMAP_LINEAR,w.Z.LINEAR_MIPMAP_NEAREST,w.Z.LINEAR_MIPMAP_LINEAR].includes(e.minificationFilter)}function O(e,t){const{pixelFormat:r,pixelDatatype:n,width:a,height:i,typedArray:o,sampler:s}=e;return new Z.Z({context:t,pixelFormat:r,pixelDatatype:n,source:{arrayBufferView:o,width:a,height:i},sampler:s,flipY:!1})}I.prototype.getTexture=function(e){return this._textures[e]},I.prototype.loadTexture2D=function(e,t){(0,h.Z)(t.typedArray)?this._loadedImages.push({id:e,textureUniform:t}):A(this,e,t)},I.prototype.update=function(e){if(e.frameNumber===this._lastUpdatedFrame)return;this._lastUpdatedFrame=e.frameNumber;const t=e.context;this._defaultTexture=t.defaultTexture;const r=this._loadedImages;for(let n=0;n<r.length;n++){const e=r[n];P(this,e,t)}r.length=0},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){const e=this._textures;for(const t in e)if(e.hasOwnProperty(t)){const r=e[t];r!==this._defaultTexture&&r.destroy()}return(0,g.Z)(this)};var N=I,F=r(7332);function L(e){e=(0,p.Z)(e,p.Z.EMPTY_OBJECT),this.mode=(0,p.Z)(e.mode,E.Z.MODIFY_MATERIAL),this.lightingModel=e.lightingModel,this.uniforms=(0,p.Z)(e.uniforms,p.Z.EMPTY_OBJECT),this.varyings=(0,p.Z)(e.varyings,p.Z.EMPTY_OBJECT),this.vertexShaderText=e.vertexShaderText,this.fragmentShaderText=e.fragmentShaderText,this.translucencyMode=(0,p.Z)(e.translucencyMode,F.Z.INHERIT),this._textureManager=new N,this._defaultTexture=void 0,this.uniformMap=U(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},$(this),J(this)}function U(e){const t=e.uniforms,r={};for(const n in t)if(t.hasOwnProperty(n)){const a=t[n],i=a.type;if(i===_.SAMPLER_CUBE)throw new x.Z("CustomShader does not support samplerCube uniforms");i===_.SAMPLER_2D?(e._textureManager.loadTexture2D(n,a.value),r[n]=z(e,n)):r[n]=B(e,n)}return r}function z(e,t){return function(){return(0,p.Z)(e._textureManager.getTexture(t),e._defaultTexture)}}function B(e,t){return function(){return e.uniforms[t].value}}function H(e,t,r){let n;while(null!==(n=t.exec(e))){const e=n[1];r[e]=!0}}function $(e){const t=/[vf]sInput\.attributes\.(\w+)/g,r=/[vf]sInput\.featureIds\.(\w+)/g,n=/[vf]sInput\.metadata.(\w+)/g;let a;const i=e.vertexShaderText;(0,h.Z)(i)&&(a=e.usedVariablesVertex.attributeSet,H(i,t,a),a=e.usedVariablesVertex.featureIdSet,H(i,r,a),a=e.usedVariablesVertex.metadataSet,H(i,n,a));const o=e.fragmentShaderText;if((0,h.Z)(o)){a=e.usedVariablesFragment.attributeSet,H(o,t,a),a=e.usedVariablesFragment.featureIdSet,H(o,r,a),a=e.usedVariablesFragment.metadataSet,H(o,n,a);const i=/material\.(\w+)/g,s=e.usedVariablesFragment.materialSet;H(o,i,s)}}function Y(e){const t=/^.*MC$/,r=/^.*WC$/,n=/^.*EC$/;return t.test(e)?`${e} (model coordinates)`:r.test(e)?`${e} (Cartesian world coordinates)`:n.test(e)?`${e} (eye coordinates)`:e}function k(e,t,r,n){if(e.hasOwnProperty(t)){const e=`${Y(t)} is not available in the ${n} shader. Did you mean ${Y(r)} instead?`;throw new x.Z(e)}}function J(e){const t=e.usedVariablesVertex.attributeSet;k(t,"position","positionMC","vertex"),k(t,"normal","normalMC","vertex"),k(t,"tangent","tangentMC","vertex"),k(t,"bitangent","bitangentMC","vertex"),k(t,"positionWC","positionMC","vertex"),k(t,"positionEC","positionMC","vertex"),k(t,"normalEC","normalMC","vertex"),k(t,"tangentEC","tangentMC","vertex"),k(t,"bitangentEC","bitangentMC","vertex");const r=e.usedVariablesFragment.attributeSet;k(r,"position","positionEC","fragment"),k(r,"normal","normalEC","fragment"),k(r,"tangent","tangentEC","fragment"),k(r,"bitangent","bitangentEC","fragment"),k(r,"normalMC","normalEC","fragment"),k(r,"tangentMC","tangentEC","fragment"),k(r,"bitangentMC","bitangentEC","fragment")}L.prototype.setUniform=function(e,t){if(l.Z.typeOf.string("uniformName",e),l.Z.defined("value",t),!(0,h.Z)(this.uniforms[e]))throw new x.Z(`Uniform ${e} must be declared in the CustomShader constructor.`);const r=this.uniforms[e];r.type===_.SAMPLER_2D?this._textureManager.loadTexture2D(e,t):(0,h.Z)(t.clone)?r.value=t.clone(r.value):r.value=t},L.prototype.update=function(e){this._defaultTexture=e.context.defaultTexture,this._textureManager.update(e)},L.prototype.isDestroyed=function(){return!1},L.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),(0,g.Z)(this)};var q=L,W=r(8085),j=r(1561),G={data(){return{path:"/webgis-demo/"}},mounted(){this.init()},methods:{init(){var e=new o.Z("cesiumContainer",{imageryProvider:new s.Z({url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",subdomains:["a","b","c","d"]}),terrainProvider:u.Z()});d.Z.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio),e.scene.postProcessStages.fxaa.enabled=!0,e.scene.debugShowFramesPerSecond=!0;const t=c.Z.fromDegrees(-74.01881302800248,40.69114333714821,753),r=new m.Z.fromDegrees(21.27879878293835,-21.34390550872461,.0716951918898415);e.scene.camera.setView({destination:t,orientation:r,endTransform:f.Z.IDENTITY});const n=new q({uniforms:{maxHeight:{type:_.FLOAT,value:0},minHeight:{type:_.FLOAT,value:0}},fragmentShaderText:"\n          void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {\n            float curz = fsInput.attributes.positionMC.z;\n            float d = (curz - minHeight) / (maxHeight - minHeight);\n            float r = 0.01;\n            r = fract(r * czm_frameNumber);\n            float c = smoothstep(r, r+0.03, d) - smoothstep(r + 0.035,r + 0.04, d);\n            vec3 linearColor = mix(vec3(1.0,1.0,1.0) ,vec3(255.0,48.0,48.0)/255.0,r);\n            vec3 renderColor = mix(vec3(0.0,0.96,1.0) ,linearColor,c);\n            material.diffuse = renderColor;\n          }"}),a=new W.Z({url:j.Z.fromAssetId(96188),customShader:n});a.readyPromise.then((t=>{const[r,n]=[t.properties["cesium#estimatedHeight"].maximum,t.properties["cesium#estimatedHeight"].minimum];t.customShader.setUniform("maxHeight",r),t.customShader.setUniform("minHeight",n),e.scene.primitives.add(t)}))}}},K=r(89);const Q=(0,K.Z)(G,[["render",i],["__scopeId","data-v-974c3aec"]]);var X=Q}}]);
//# sourceMappingURL=488.bbc2c36a.js.map