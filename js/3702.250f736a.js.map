{"version":3,"file":"js/3702.250f736a.js","mappings":"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","sources":["webpack://webgis/./src/components/public/cesium_threejs.vue","webpack://webgis/./src/components/public/cesium_threejs.vue?87f1"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div id=\"cesiumContainer\"></div>\n    <canvas id=\"threeContainer\"></canvas>\n  </div>\n</template>\n\n//\n<script>\nimport 'cesium/Build/Cesium/Widgets/widgets.css'\nimport {\n  Viewer,\n  ShadowMode,\n  Cartesian3,\n  Math as CesiumMath,\n  Color,\n} from 'cesium'\nimport * as THREE from 'three'\n\nconst cesium = {\n  viewer: null,\n}\nconst three = {\n  renderer: null,\n  camera: null,\n  scene: null,\n}\n// boundaries in WGS84 around the object\nlet minWGS84 = [115.23, 39.55]\nlet maxWGS84 = [116.23, 41.55]\n\nconst _3Dobjects = []\nfunction _3DObject() {\n  this.threeMesh = null //Three.js 3DObject.mesh\n  this.minWGS84 = null //location bounding box\n  this.maxWGS84 = null\n}\n\nexport default {\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      this.initCesium()\n      this.initThreejs()\n      this.init3DObject()\n      this.startRenderLoop()\n    },\n    initCesium() {\n      cesium.viewer = new Viewer('cesiumContainer', {\n        useDefaultRenderLoop: false,\n        selectionIndicator: false,\n        infoBox: false,\n        navigationInstructionsInitiallyVisible: false,\n        fullscreenButton: false,\n        allowTextureFilterAnisotropic: false,\n        contextOptions: {\n          webgl: {\n            alpha: false,\n            antialias: true,\n            preserveDrawingBuffer: true,\n            failIfMajorPerformanceCaveat: false,\n            depth: true,\n            stencil: false,\n            anialias: false,\n          },\n        },\n        targetFrameRate: 60,\n        resolutionScale: 0.1,\n        orderIndependentTranslucency: true,\n        imageryProvider: undefined,\n        baseLayerPicker: false,\n        automaticallyTrackDataSourceClocks: false,\n        dataSources: null,\n        clock: null,\n        terrainShadows: ShadowMode.DISABLED,\n      })\n      const center = Cartesian3.fromDegrees(\n        (minWGS84[0] + maxWGS84[0]) / 2,\n        (minWGS84[1] + maxWGS84[1]) / 2 - 1,\n        200000\n      )\n      cesium.viewer.camera.flyTo({\n        destination: center,\n        orientation: {\n          heading: CesiumMath.toRadians(0),\n          pitch: CesiumMath.toRadians(-60),\n          roll: CesiumMath.toRadians(0),\n        },\n        duration: 3,\n      })\n    },\n    initThreejs() {\n      const canvas = document.querySelector('#threeContainer')\n      const renderer = new THREE.WebGLRenderer({\n        canvas: canvas,\n        alpha: true,\n        logarithmicDepthBuffer: true,\n        antialias: true,\n      })\n\n      var fov = 45\n      var width = canvas.clientWidth\n      var height = canvas.clientHeight\n      var aspect = width / height\n      var near = 1\n      var far = 10 * 1000 * 1000\n      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far)\n\n      const scene = new THREE.Scene()\n\n      three.renderer = renderer\n      three.scene = scene\n      three.camera = camera\n    },\n    init3DObject() {\n      // Cesium entity\n      const entity = {\n        name: 'Polygon',\n        polygon: {\n          hierarchy: Cartesian3.fromDegreesArray([\n            minWGS84[0],\n            minWGS84[1],\n            maxWGS84[0],\n            minWGS84[1],\n            maxWGS84[0],\n            maxWGS84[1],\n            minWGS84[0],\n            maxWGS84[1],\n          ]),\n          material: Color.RED.withAlpha(0.2),\n        },\n      }\n      cesium.viewer.entities.add(entity)\n      //Three.js Objects\n      /**\n       *  three的坐标系（右手坐标系），关键数据结构 Vector3\n       *    Y\n       *    |\n       *    |___ X\n       *   /\n       * Z\n       *\n       * Cesium的坐标系，关键数据结构 Cartesian3\n       *    Z\n       *    |\n       *    |__ Y\n       *   /\n       * X\n       *\n       */\n      // 在three的坐标系空间里，先向Z轴平移模型，然后绕X轴向上翻转90度，物体就面向Y轴了，对应Cesiumn的Z轴\n      // Lathe geometry\n      var doubleSideMaterial = new THREE.MeshNormalMaterial({\n        side: THREE.DoubleSide,\n      })\n      var segments = 10\n      var points = []\n      for (var i = 0; i < segments; i++) {\n        points.push(\n          new THREE.Vector2(Math.sin(i * 0.2) * segments + 5, (i - 5) * 2)\n        )\n      }\n      var geometry = new THREE.LatheGeometry(points)\n      var latheMesh = new THREE.Mesh(geometry, doubleSideMaterial)\n      latheMesh.scale.set(1500, 1500, 1500) //scale object to be visible at planet scale\n      latheMesh.position.z += 15000 // translate \"up\" in Three.js space so the \"bottom\" of the mesh is the handle\n      latheMesh.rotation.x = Math.PI / 2 // rotate mesh for Cesium's Y-up system\n      var latheMeshYup = new THREE.Group()\n      latheMeshYup.add(latheMesh)\n      three.scene.add(latheMeshYup) // don’t forget to add it to the Three.js scene manually\n\n      //Assign Three.js object mesh to our object array\n      var _3DOB = new _3DObject()\n      _3DOB.threeMesh = latheMeshYup\n      _3DOB.minWGS84 = minWGS84\n      _3DOB.maxWGS84 = maxWGS84\n      _3Dobjects.push(_3DOB)\n\n      // dodecahedron\n      geometry = new THREE.DodecahedronGeometry()\n      var dodecahedronMesh = new THREE.Mesh(\n        geometry,\n        new THREE.MeshNormalMaterial()\n      )\n      dodecahedronMesh.scale.set(10000, 10000, 10000) //scale object to be visible at planet scale\n      dodecahedronMesh.position.z += 10000 // translate \"up\" in Three.js space so the \"bottom\" of the mesh is the handle\n      dodecahedronMesh.rotation.x = Math.PI / 2 // rotate mesh for Cesium's Y-up system\n      var dodecahedronMeshYup = new THREE.Group()\n      dodecahedronMeshYup.add(dodecahedronMesh)\n      three.scene.add(dodecahedronMeshYup) // don’t forget to add it to the Three.js scene manually\n\n      //Assign Three.js object mesh to our object array\n      _3DOB = new _3DObject()\n      _3DOB.threeMesh = dodecahedronMeshYup\n      _3DOB.minWGS84 = minWGS84\n      _3DOB.maxWGS84 = maxWGS84\n      _3Dobjects.push(_3DOB)\n\n      // Configure Three.js meshes to stand against globe center position up direction\n      for (const id in _3Dobjects) {\n        minWGS84 = _3Dobjects[id].minWGS84\n        maxWGS84 = _3Dobjects[id].maxWGS84\n        // convert lat/long center position to Cartesian3\n        const center = Cartesian3.fromDegrees(\n          (minWGS84[0] + maxWGS84[0]) / 2,\n          (minWGS84[1] + maxWGS84[1]) / 2\n        )\n\n        // get forward direction for orienting model\n        const centerHigh = Cartesian3.fromDegrees(\n          (minWGS84[0] + maxWGS84[0]) / 2,\n          (minWGS84[1] + maxWGS84[1]) / 2,\n          1\n        )\n\n        // use direction from bottom left to top left as up-vector\n\n        // configure entity position and orientation\n        _3Dobjects[id].threeMesh.position.copy(center)\n        _3Dobjects[id].threeMesh.lookAt(\n          centerHigh.x,\n          centerHigh.y,\n          centerHigh.z\n        )\n      }\n    },\n    threeRender() {\n      // Clone Cesium Camera projection position so the\n      // Three.js Object will appear to be at the same place as above the Cesium Globe\n      three.camera.matrixAutoUpdate = false\n      const cvm = cesium.viewer.camera.viewMatrix\n      const civm = cesium.viewer.camera.inverseViewMatrix\n\n      three.camera.lookAt(0, 0, 0)\n      three.camera.matrixWorld.set(\n        civm[0],\n        civm[4],\n        civm[8],\n        civm[12],\n        civm[1],\n        civm[5],\n        civm[9],\n        civm[13],\n        civm[2],\n        civm[6],\n        civm[10],\n        civm[14],\n        civm[3],\n        civm[7],\n        civm[11],\n        civm[15]\n      )\n      three.camera.matrixWorldInverse.set(\n        cvm[0],\n        cvm[4],\n        cvm[8],\n        cvm[12],\n        cvm[1],\n        cvm[5],\n        cvm[9],\n        cvm[13],\n        cvm[2],\n        cvm[6],\n        cvm[10],\n        cvm[14],\n        cvm[3],\n        cvm[7],\n        cvm[11],\n        cvm[15]\n      )\n      const canvas = three.renderer.domElement\n      three.renderer.setPixelRatio(window.devicePixelRatio)\n      const width = canvas.clientWidth\n      const height = canvas.clientHeight\n      const needResize = canvas.width !== width || canvas.height !== height\n      if (needResize) {\n        three.renderer.setSize(width, height, false)\n      }\n      three.camera.aspect = width / height\n      three.camera.fov = CesiumMath.toDegrees(cesium.viewer.camera.frustum.fovy)\n      three.camera.updateProjectionMatrix()\n      three.renderer.render(three.scene, three.camera)\n    },\n    startRenderLoop() {\n      cesium.viewer.render()\n      this.threeRender()\n      requestAnimationFrame(this.startRenderLoop)\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n}\n\n#cesiumContainer {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n}\n\n#threeContainer {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  margin: 0%;\n  z-index: 10;\n  pointer-events: none;\n}\n</style>\n","import { render } from \"./cesium_threejs.vue?vue&type=template&id=4f41587c&scoped=true\"\nimport script from \"./cesium_threejs.vue?vue&type=script&lang=js\"\nexport * from \"./cesium_threejs.vue?vue&type=script&lang=js\"\n\nimport \"./cesium_threejs.vue?vue&type=style&index=0&id=4f41587c&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhengjie/Documents/webgis/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4f41587c\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","id","_hoisted_2","_hoisted_3","_createElementBlock","_hoisted_1","cesium","viewer","three","renderer","camera","scene","minWGS84","maxWGS84","_3Dobjects","_3DObject","this","threeMesh","mounted","init","methods","initCesium","initThreejs","init3DObject","startRenderLoop","Viewer","useDefaultRenderLoop","selectionIndicator","infoBox","navigationInstructionsInitiallyVisible","fullscreenButton","allowTextureFilterAnisotropic","contextOptions","webgl","alpha","antialias","preserveDrawingBuffer","failIfMajorPerformanceCaveat","depth","stencil","anialias","targetFrameRate","resolutionScale","orderIndependentTranslucency","imageryProvider","undefined","baseLayerPicker","automaticallyTrackDataSourceClocks","dataSources","clock","terrainShadows","ShadowMode","center","Cartesian3","flyTo","destination","orientation","heading","CesiumMath","pitch","roll","duration","canvas","document","querySelector","THREE","logarithmicDepthBuffer","fov","width","clientWidth","height","clientHeight","aspect","near","far","entity","name","polygon","hierarchy","material","Color","entities","add","doubleSideMaterial","side","segments","points","i","push","Math","sin","geometry","latheMesh","scale","set","position","z","rotation","x","PI","latheMeshYup","_3DOB","dodecahedronMesh","dodecahedronMeshYup","centerHigh","copy","lookAt","y","threeRender","matrixAutoUpdate","cvm","viewMatrix","civm","inverseViewMatrix","matrixWorld","matrixWorldInverse","domElement","setPixelRatio","window","devicePixelRatio","needResize","setSize","frustum","fovy","updateProjectionMatrix","render","requestAnimationFrame","__exports__"],"sourceRoot":""}