(self["webpackChunkwebgis"]=self["webpackChunkwebgis"]||[]).push([[873],{7944:function(e,t,r){var i,n;r(63408),r(14590),r(30541),r(57658),
/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
function(){var r=function(){var e={defaultNoDataValue:-34027999387901484e22,decode:function(a,s){s=s||{};var o=s.encodedMaskData||null===s.encodedMaskData,l=n(a,s.inputOffset||0,o),u=null!==s.noDataValue?s.noDataValue:e.defaultNoDataValue,c=t(l,s.pixelType||Float32Array,s.encodedMaskData,u,s.returnMask),h={width:l.width,height:l.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:l.pixels.maxValue,noDataValue:u};return c.resultMask&&(h.maskData=c.resultMask),s.returnEncodedMask&&l.mask&&(h.encodedMaskData=l.mask.bitset?l.mask.bitset:null),s.returnFileInfo&&(h.fileInfo=r(l),s.computeUsedBitDepths&&(h.fileInfo.bitDepths=i(l))),h}},t=function(e,t,r,i,n){var s,o,l,u=0,c=e.pixels.numBlocksX,h=e.pixels.numBlocksY,d=Math.floor(e.width/c),f=Math.floor(e.height/h),_=2*e.maxZError,m=Number.MAX_VALUE;r=r||(e.mask?e.mask.bitset:null),o=new t(e.width*e.height),n&&r&&(l=new Uint8Array(e.width*e.height));for(var g,p,y=new Float32Array(d*f),v=0;v<=h;v++){var b=v!==h?f:e.height%h;if(0!==b)for(var w=0;w<=c;w++){var x=w!==c?d:e.width%c;if(0!==x){var Z,P,D,k,I=v*e.width*f+w*d,T=e.width-x,U=e.pixels.blocks[u];if(U.encoding<2?(0===U.encoding?Z=U.rawData:(a(U.stuffedData,U.bitsPerPixel,U.numValidPixels,U.offset,_,y,e.pixels.maxValue),Z=y),P=0):D=2===U.encoding?0:U.offset,r)for(p=0;p<b;p++){for(7&I&&(k=r[I>>3],k<<=7&I),g=0;g<x;g++)7&I||(k=r[I>>3]),128&k?(l&&(l[I]=1),s=U.encoding<2?Z[P++]:D,m=m>s?s:m,o[I++]=s):(l&&(l[I]=0),o[I++]=i),k<<=1;I+=T}else if(U.encoding<2)for(p=0;p<b;p++){for(g=0;g<x;g++)s=Z[P++],m=m>s?s:m,o[I++]=s;I+=T}else for(m=m>D?D:m,p=0;p<b;p++){for(g=0;g<x;g++)o[I++]=D;I+=T}if(1===U.encoding&&P!==U.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:o,resultMask:l,minValue:m}},r=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},i=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,r={},i=0;i<t;i++){var n=e.pixels.blocks[i];0===n.encoding?r.float32=!0:1===n.encoding?r[n.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},n=function(e,t,r){var i={},n=new Uint8Array(e,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(i.fileVersion=a.getInt32(0,!0),i.imageType=a.getInt32(4,!0),i.height=a.getUint32(8,!0),i.width=a.getUint32(12,!0),i.maxZError=a.getFloat64(16,!0),t+=24,!r)if(a=new DataView(e,t,16),i.mask={},i.mask.numBlocksY=a.getUint32(0,!0),i.mask.numBlocksX=a.getUint32(4,!0),i.mask.numBytes=a.getUint32(8,!0),i.mask.maxValue=a.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var s=new Uint8Array(Math.ceil(i.width*i.height/8));a=new DataView(e,t,i.mask.numBytes);var o=a.getInt16(0,!0),l=2,u=0;do{if(o>0)while(o--)s[u++]=a.getUint8(l++);else{var c=a.getUint8(l++);o=-o;while(o--)s[u++]=c}o=a.getInt16(l,!0),l+=2}while(l<i.mask.numBytes);if(-32768!==o||u<s.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=s,t+=i.mask.numBytes}else 0===(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));a=new DataView(e,t,16),i.pixels={},i.pixels.numBlocksY=a.getUint32(0,!0),i.pixels.numBlocksX=a.getUint32(4,!0),i.pixels.numBytes=a.getUint32(8,!0),i.pixels.maxValue=a.getFloat32(12,!0),t+=16;var h=i.pixels.numBlocksX,d=i.pixels.numBlocksY,f=h+(i.width%h>0?1:0),_=d+(i.height%d>0?1:0);i.pixels.blocks=new Array(f*_);for(var m=0,g=0;g<_;g++)for(var p=0;p<f;p++){var y=0,v=e.byteLength-t;a=new DataView(e,t,Math.min(10,v));var b={};i.pixels.blocks[m++]=b;var w=a.getUint8(0);if(y++,b.encoding=63&w,b.encoding>3)throw"Invalid block encoding ("+b.encoding+")";if(2!==b.encoding){if(0!==w&&2!==w){if(w>>=6,b.offsetType=w,2===w)b.offset=a.getInt8(1),y++;else if(1===w)b.offset=a.getInt16(1,!0),y+=2;else{if(0!==w)throw"Invalid block offset type";b.offset=a.getFloat32(1,!0),y+=4}if(1===b.encoding)if(w=a.getUint8(y),y++,b.bitsPerPixel=63&w,w>>=6,b.numValidPixelsType=w,2===w)b.numValidPixels=a.getUint8(y),y++;else if(1===w)b.numValidPixels=a.getUint16(y,!0),y+=2;else{if(0!==w)throw"Invalid valid pixel count type";b.numValidPixels=a.getUint32(y,!0),y+=4}}var x,Z;if(t+=y,3!==b.encoding)if(0===b.encoding){var P=(i.pixels.numBytes-1)/4;if(P!==Math.floor(P))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*P),Z=new Uint8Array(x),Z.set(new Uint8Array(e,t,4*P));var D=new Float32Array(x);b.rawData=D,t+=4*P}else if(1===b.encoding){var k=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),I=Math.ceil(k/4);x=new ArrayBuffer(4*I),Z=new Uint8Array(x),Z.set(new Uint8Array(e,t,k)),b.stuffedData=new Uint32Array(x),t+=k}}else t++}return i.eofOffset=t,i},a=function(e,t,r,i,n,a,s){var o,l,u,c=(1<<t)-1,h=0,d=0,f=Math.ceil((s-i)/n),_=4*e.length-Math.ceil(t*r/8);for(e[e.length-1]<<=8*_,o=0;o<r;o++){if(0===d&&(u=e[h++],d=32),d>=t)l=u>>>d-t&c,d-=t;else{var m=t-d;l=(u&c)<<m&c,u=e[h++],d=32-m,l+=u>>>d}a[o]=l<f?i+l*n:s}return a};return e}(),a=function(){"use strict";var e={unstuff:function(e,t,r,i,n,a,s,o){var l,u,c,h,d,f=(1<<r)-1,_=0,m=0,g=4*e.length-Math.ceil(r*i/8);if(e[e.length-1]<<=8*g,n)for(l=0;l<i;l++)0===m&&(c=e[_++],m=32),m>=r?(u=c>>>m-r&f,m-=r):(h=r-m,u=(c&f)<<h&f,c=e[_++],m=32-h,u+=c>>>m),t[l]=n[u];else for(d=Math.ceil((o-a)/s),l=0;l<i;l++)0===m&&(c=e[_++],m=32),m>=r?(u=c>>>m-r&f,m-=r):(h=r-m,u=(c&f)<<h&f,c=e[_++],m=32-h,u+=c>>>m),t[l]=u<d?a+u*s:o},unstuffLUT:function(e,t,r,i,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,h=0,d=0,f=[],_=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*_;var m=Math.ceil((a-i)/n);for(u=0;u<r;u++)0===h&&(s=e[l++],h=32),h>=t?(d=s>>>h-t&o,h-=t):(c=t-h,d=(s&o)<<c&o,s=e[l++],h=32-c,d+=s>>>h),f[u]=d<m?i+d*n:a;return f.unshift(i),f},unstuff2:function(e,t,r,i,n,a,s,o){var l,u,c,h,d=(1<<r)-1,f=0,_=0,m=0;if(n)for(l=0;l<i;l++)0===_&&(c=e[f++],_=32,m=0),_>=r?(u=c>>>m&d,_-=r,m+=r):(h=r-_,u=c>>>m&d,c=e[f++],_=32-h,u|=(c&(1<<h)-1)<<r-h,m=h),t[l]=n[u];else{var g=Math.ceil((o-a)/s);for(l=0;l<i;l++)0===_&&(c=e[f++],_=32,m=0),_>=r?(u=c>>>m&d,_-=r,m+=r):(h=r-_,u=c>>>m&d,c=e[f++],_=32-h,u|=(c&(1<<h)-1)<<r-h,m=h),t[l]=u<g?a+u*s:o}return t},unstuffLUT2:function(e,t,r,i,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,h=0,d=0,f=0,_=[],m=Math.ceil((a-i)/n);for(u=0;u<r;u++)0===h&&(s=e[l++],h=32,f=0),h>=t?(d=s>>>f&o,h-=t,f+=t):(c=t-h,d=s>>>f&o,s=e[l++],h=32-c,d|=(s&(1<<c)-1)<<t-c,f=c),_[u]=d<m?i+d*n:a;return _.unshift(i),_},originalUnstuff:function(e,t,r,i){var n,a,s,o,l=(1<<r)-1,u=0,c=0,h=4*e.length-Math.ceil(r*i/8);for(e[e.length-1]<<=8*h,n=0;n<i;n++)0===c&&(s=e[u++],c=32),c>=r?(a=s>>>c-r&l,c-=r):(o=r-c,a=(s&l)<<o&l,s=e[u++],c=32-o,a+=s>>>c),t[n]=a;return t},originalUnstuff2:function(e,t,r,i){var n,a,s,o,l=(1<<r)-1,u=0,c=0,h=0;for(n=0;n<i;n++)0===c&&(s=e[u++],c=32,h=0),c>=r?(a=s>>>h&l,c-=r,h+=r):(o=r-c,a=s>>>h&l,s=e[u++],c=32-o,a|=(s&(1<<o)-1)<<r-o,h=o),t[n]=a;return t}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var t=65535,r=65535,i=e.length,n=Math.floor(i/2),a=0;while(n){var s=n>=359?359:n;n-=s;do{t+=e[a++]<<8,r+=t+=e[a++]}while(--s);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&i&&(r+=t+=e[a]<<8),t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16),(r<<16|t)>>>0},readHeaderInfo:function(e,t){var r=t.ptr,i=new Uint8Array(e,r,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,i),0!==n.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;r+=6;var a,s,o=new DataView(e,r,8),l=o.getInt32(0,!0);if(n.fileVersion=l,r+=4,l>=3&&(n.checksum=o.getUint32(4,!0),r+=4),o=new DataView(e,r,12),n.height=o.getUint32(0,!0),n.width=o.getUint32(4,!0),r+=8,l>=4?(n.numDims=o.getUint32(8,!0),r+=4):n.numDims=1,o=new DataView(e,r,40),n.numValidPixel=o.getUint32(0,!0),n.microBlockSize=o.getInt32(4,!0),n.blobSize=o.getInt32(8,!0),n.imageType=o.getInt32(12,!0),n.maxZError=o.getFloat64(16,!0),n.zMin=o.getFloat64(24,!0),n.zMax=o.getFloat64(32,!0),r+=40,t.headerInfo=n,t.ptr=r,l>=3&&(s=l>=4?52:48,a=this.computeChecksumFletcher32(new Uint8Array(e,r-s,n.blobSize-14)),a!==n.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,i=this.getDataTypeArray(r.imageType),n=r.numDims*this.getDataTypeSize(r.imageType),a=this.readSubArray(e,t.ptr,i,n),s=this.readSubArray(e,t.ptr+n,i,n);t.ptr+=2*n;var o,l=!0;for(o=0;o<r.numDims;o++)if(a[o]!==s[o]){l=!1;break}return r.minValues=a,r.maxValues=s,l},readSubArray:function(e,t,r,i){var n;if(r===Uint8Array)n=new Uint8Array(e,t,i);else{var a=new ArrayBuffer(i),s=new Uint8Array(a);s.set(new Uint8Array(e,t,i)),n=new r(a)}return n},readMask:function(e,t){var r,i,n=t.ptr,a=t.headerInfo,s=a.width*a.height,o=a.numValidPixel,l=new DataView(e,n,4),u={};if(u.numBytes=l.getUint32(0,!0),n+=4,(0===o||s===o)&&0!==u.numBytes)throw"invalid mask";if(0===o)r=new Uint8Array(Math.ceil(s/8)),u.bitset=r,i=new Uint8Array(s),t.pixels.resultMask=i,n+=u.numBytes;else if(u.numBytes>0){r=new Uint8Array(Math.ceil(s/8)),l=new DataView(e,n,u.numBytes);var c=l.getInt16(0,!0),h=2,d=0,f=0;do{if(c>0)while(c--)r[d++]=l.getUint8(h++);else{f=l.getUint8(h++),c=-c;while(c--)r[d++]=f}c=l.getInt16(h,!0),h+=2}while(h<u.numBytes);if(-32768!==c||d<r.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(s);var _=0,m=0;for(m=0;m<s;m++)7&m?(_=r[m>>3],_<<=7&m):_=r[m>>3],128&_&&(i[m]=1);t.pixels.resultMask=i,u.bitset=r,n+=u.numBytes}return t.ptr=n,t.mask=u,!0},readDataOneSweep:function(e,r,i){var n,a=r.ptr,s=r.headerInfo,o=s.numDims,l=s.width*s.height,u=s.imageType,c=s.numValidPixel*t.getDataTypeSize(u)*o,h=r.pixels.resultMask;if(i===Uint8Array)n=new Uint8Array(e,a,c);else{var d=new ArrayBuffer(c),f=new Uint8Array(d);f.set(new Uint8Array(e,a,c)),n=new i(d)}if(n.length===l*o)r.pixels.resultPixels=n;else{r.pixels.resultPixels=new i(l*o);var _=0,m=0,g=0,p=0;if(o>1)for(g=0;g<o;g++)for(p=g*l,m=0;m<l;m++)h[m]&&(r.pixels.resultPixels[p+m]=n[_++]);else for(m=0;m<l;m++)h[m]&&(r.pixels.resultPixels[m]=n[_++])}return a+=c,r.ptr=a,!0},readHuffmanTree:function(e,i){var n=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(e,i.ptr,16);i.ptr+=16;var s=a.getInt32(0,!0);if(s<2)throw"unsupported Huffman version";var o=a.getInt32(4,!0),l=a.getInt32(8,!0),u=a.getInt32(12,!0);if(l>=u)return!1;var c=new Uint32Array(u-l);t.decodeBits(e,i,c);var h,d,f,_,m=[];for(h=l;h<u;h++)d=h-(h<o?0:o),m[d]={first:c[h-l],second:null};var g=e.byteLength-i.ptr,p=Math.ceil(g/4),y=new ArrayBuffer(4*p),v=new Uint8Array(y);v.set(new Uint8Array(e,i.ptr,g));var b,w=new Uint32Array(y),x=0,Z=0;for(b=w[0],h=l;h<u;h++)d=h-(h<o?0:o),_=m[d].first,_>0&&(m[d].second=b<<x>>>32-_,32-x>=_?(x+=_,32===x&&(x=0,Z++,b=w[Z])):(x+=_-32,Z++,b=w[Z],m[d].second|=b>>>32-x));var P=0,D=0,k=new r;for(h=0;h<m.length;h++)void 0!==m[h]&&(P=Math.max(P,m[h].first));D=P>=n?n:P,P>=30&&console.log("WARning, large NUM LUT BITS IS "+P);var I,T,U,A,S,M,V=[];for(h=l;h<u;h++)if(d=h-(h<o?0:o),_=m[d].first,_>0)if(I=[_,d],_<=D)for(T=m[d].second<<D-_,U=1<<D-_,f=0;f<U;f++)V[T|f]=I;else for(T=m[d].second,M=k,A=_-1;A>=0;A--)S=T>>>A&1,S?(M.right||(M.right=new r),M=M.right):(M.left||(M.left=new r),M=M.left),0!==A||M.val||(M.val=I[1]);return{decodeLut:V,numBitsLUTQick:D,numBitsLUT:P,tree:k,stuffedData:w,srcPtr:Z,bitPos:x}},readHuffman:function(e,t,r){var i,n,a,s,o,l,u,c,h,d,f=t.headerInfo,_=f.numDims,m=t.headerInfo.height,g=t.headerInfo.width,p=g*m,y=this.readHuffmanTree(e,t),v=y.decodeLut,b=y.tree,w=y.stuffedData,x=y.srcPtr,Z=y.bitPos,P=y.numBitsLUTQick,D=y.numBitsLUT,k=0===t.headerInfo.imageType?128:0,I=t.pixels.resultMask,T=0;Z>0&&(x++,Z=0);var U,A=w[x],S=1===t.encodeMode,M=new r(p*_),V=M;for(U=0;U<f.numDims;U++){if(_>1&&(V=new r(M.buffer,p*U,p),T=0),t.headerInfo.numValidPixel===g*m)for(h=0,u=0;u<m;u++)for(c=0;c<g;c++,h++){if(n=0,s=A<<Z>>>32-P,o=s,32-Z<P&&(s|=w[x+1]>>>64-Z-P,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=A<<Z>>>32-D,o=s,32-Z<D&&(s|=w[x+1]>>>64-Z-D,o=s),i=b,d=0;d<D;d++)if(l=s>>>D-d-1&1,i=l?i.right:i.left,!i.left&&!i.right){n=i.val,Z=Z+d+1;break}Z>=32&&(Z-=32,x++,A=w[x]),a=n-k,S?(a+=c>0?T:u>0?V[h-g]:T,a&=255,V[h]=a,T=a):V[h]=a}else for(h=0,u=0;u<m;u++)for(c=0;c<g;c++,h++)if(I[h]){if(n=0,s=A<<Z>>>32-P,o=s,32-Z<P&&(s|=w[x+1]>>>64-Z-P,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=A<<Z>>>32-D,o=s,32-Z<D&&(s|=w[x+1]>>>64-Z-D,o=s),i=b,d=0;d<D;d++)if(l=s>>>D-d-1&1,i=l?i.right:i.left,!i.left&&!i.right){n=i.val,Z=Z+d+1;break}Z>=32&&(Z-=32,x++,A=w[x]),a=n-k,S?(c>0&&I[h-1]?a+=T:u>0&&I[h-g]?a+=V[h-g]:a+=T,a&=255,V[h]=a,T=a):V[h]=a}t.ptr=t.ptr+4*(x+1)+(Z>0?4:0)}t.pixels.resultPixels=M},decodeBits:function(t,r,i,n,a){var s=r.headerInfo,o=s.fileVersion,l=0,u=new DataView(t,r.ptr,5),c=u.getUint8(0);l++;var h=c>>6,d=0===h?4:3-h,f=(32&c)>0,_=31&c,m=0;if(1===d)m=u.getUint8(l),l++;else if(2===d)m=u.getUint16(l,!0),l+=2;else{if(4!==d)throw"Invalid valid pixel count type";m=u.getUint32(l,!0),l+=4}var g,p,y,v,b,w,x,Z,P,D=2*s.maxZError,k=s.numDims>1?s.maxValues[a]:s.zMax;if(f){r.counter.lut++,Z=u.getUint8(l),_,l++,v=Math.ceil((Z-1)*_/8),b=Math.ceil(v/4),p=new ArrayBuffer(4*b),y=new Uint8Array(p),r.ptr+=l,y.set(new Uint8Array(t,r.ptr,v)),x=new Uint32Array(p),r.ptr+=v,P=0;while(Z-1>>>P)P++;v=Math.ceil(m*P/8),b=Math.ceil(v/4),p=new ArrayBuffer(4*b),y=new Uint8Array(p),y.set(new Uint8Array(t,r.ptr,v)),g=new Uint32Array(p),r.ptr+=v,w=o>=3?e.unstuffLUT2(x,_,Z-1,n,D,k):e.unstuffLUT(x,_,Z-1,n,D,k),o>=3?e.unstuff2(g,i,P,m,w):e.unstuff(g,i,P,m,w)}else r.counter.bitstuffer++,P=_,r.ptr+=l,P>0&&(v=Math.ceil(m*P/8),b=Math.ceil(v/4),p=new ArrayBuffer(4*b),y=new Uint8Array(p),y.set(new Uint8Array(t,r.ptr,v)),g=new Uint32Array(p),r.ptr+=v,o>=3?null==n?e.originalUnstuff2(g,i,P,m):e.unstuff2(g,i,P,m,!1,n,D,k):null==n?e.originalUnstuff(g,i,P,m):e.unstuff(g,i,P,m,!1,n,D,k))},readTiles:function(e,r,i){var n=r.headerInfo,a=n.width,s=n.height,o=n.microBlockSize,l=n.imageType,u=t.getDataTypeSize(l),c=Math.ceil(a/o),h=Math.ceil(s/o);r.pixels.numBlocksY=h,r.pixels.numBlocksX=c,r.pixels.ptr=0;var d,f,_,m,g,p,y,v,b,w=0,x=0,Z=0,P=0,D=0,k=0,I=0,T=0,U=0,A=0,S=0,M=0,V=0,B=0,R=0,C=0,F=new i(o*o),L=s%o||o,E=a%o||o,O=n.numDims,N=r.pixels.resultMask,z=r.pixels.resultPixels;for(Z=0;Z<h;Z++)for(D=Z!==h-1?o:L,P=0;P<c;P++)for(k=P!==c-1?o:E,S=Z*a*o+P*o,M=a-k,b=0;b<O;b++){if(O>1&&(z=new i(r.pixels.resultPixels.buffer,a*s*b*u,a*s)),I=e.byteLength-r.ptr,d=new DataView(e,r.ptr,Math.min(10,I)),f={},C=0,T=d.getUint8(0),C++,U=T>>6&255,A=T>>2&15,A!==(P*o>>3&15))throw"integrity issue";if(p=3&T,p>3)throw r.ptr+=C,"Invalid block encoding ("+p+")";if(2!==p)if(0===p){if(r.counter.uncompressed++,r.ptr+=C,V=D*k*u,B=e.byteLength-r.ptr,V=V<B?V:B,_=new ArrayBuffer(V%u===0?V:V+u-V%u),m=new Uint8Array(_),m.set(new Uint8Array(e,r.ptr,V)),g=new i(_),R=0,N)for(w=0;w<D;w++){for(x=0;x<k;x++)N[S]&&(z[S]=g[R++]),S++;S+=M}else for(w=0;w<D;w++){for(x=0;x<k;x++)z[S++]=g[R++];S+=M}r.ptr+=R*u}else if(y=t.getDataTypeUsed(l,U),v=t.getOnePixel(f,C,y,d),C+=t.getDataTypeSize(y),3===p)if(r.ptr+=C,r.counter.constantoffset++,N)for(w=0;w<D;w++){for(x=0;x<k;x++)N[S]&&(z[S]=v),S++;S+=M}else for(w=0;w<D;w++){for(x=0;x<k;x++)z[S++]=v;S+=M}else if(r.ptr+=C,t.decodeBits(e,r,F,v,b),C=0,N)for(w=0;w<D;w++){for(x=0;x<k;x++)N[S]&&(z[S]=F[C++]),S++;S+=M}else for(w=0;w<D;w++){for(x=0;x<k;x++)z[S++]=F[C++];S+=M}else r.counter.constant++,r.ptr+=C}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:t.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t=e.headerInfo.zMax,r=e.headerInfo.numDims,i=e.headerInfo.height*e.headerInfo.width,n=i*r,a=0,s=0,o=0,l=e.pixels.resultMask;if(l)if(r>1)for(a=0;a<r;a++)for(o=a*i,s=0;s<i;s++)l[s]&&(e.pixels.resultPixels[o+s]=t);else for(s=0;s<i;s++)l[s]&&(e.pixels.resultPixels[s]=t);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(t);else for(s=0;s<n;s++)e.pixels.resultPixels[s]=t},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=5e-324&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=0===t?e:1===t?2:1;break;case 7:r=0===t?e:e-2*t+1;break;default:r=e;break}return r},getOnePixel:function(e,t,r,i){var n=0;switch(r){case 0:n=i.getInt8(t);break;case 1:n=i.getUint8(t);break;case 2:n=i.getInt16(t,!0);break;case 3:n=i.getUint16(t,!0);break;case 4:n=i.getInt32(t,!0);break;case 5:n=i.getUInt32(t,!0);break;case 6:n=i.getFloat32(t,!0);break;case 7:n=i.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},r=function(e,t,r){this.val=e,this.left=t,this.right=r},i={decode:function(e,r){r=r||{};var i=r.noDataValue,n=0,a={};if(a.ptr=r.inputOffset||0,a.pixels={},t.readHeaderInfo(e,a)){var s=a.headerInfo,o=s.fileVersion,l=t.getDataTypeArray(s.imageType);t.readMask(e,a),s.numValidPixel===s.width*s.height||a.pixels.resultMask||(a.pixels.resultMask=r.maskData);var u,c=s.width*s.height;if(a.pixels.resultPixels=new l(c*s.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==s.numValidPixel)if(s.zMax===s.zMin)t.constructConstantSurface(a);else if(o>=4&&t.checkMinMaxRanges(e,a))t.constructConstantSurface(a);else{var h=new DataView(e,a.ptr,2),d=h.getUint8(0);if(a.ptr++,d)t.readDataOneSweep(e,a,l);else if(o>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var f=h.getUint8(1);if(a.ptr++,a.encodeMode=f,f>2||o<4&&f>1)throw"Invalid Huffman flag "+f;f?t.readHuffman(e,a,l):t.readTiles(e,a,l)}else t.readTiles(e,a,l)}a.eofOffset=a.ptr,r.inputOffset?(u=a.headerInfo.blobSize+r.inputOffset-a.ptr,Math.abs(u)>=1&&(a.eofOffset=r.inputOffset+a.headerInfo.blobSize)):(u=a.headerInfo.blobSize-a.ptr,Math.abs(u)>=1&&(a.eofOffset=a.headerInfo.blobSize));var _={width:s.width,height:s.height,pixelData:a.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&t.isValidPixelValue(s.imageType,i)){var m=a.pixels.resultMask;for(n=0;n<c;n++)m[n]||(_.pixelData[n]=i);_.noDataValue=i}return a.noDataValue=i,r.returnFileInfo&&(_.fileInfo=t.formatFileInfo(a)),_}},getBandCount:function(e){var r=0,i=0,n={ptr:0,pixels:{}};while(i<e.byteLength-58)t.readHeaderInfo(e,n),i+=n.headerInfo.blobSize,r++,n.ptr=i;return r}};return i}(),s=function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),r=new Uint32Array(e);return r[0]=1,1===t[0]}(),o={decode:function(e,t){if(!s)throw"Big endian system is not supported.";t=t||{};var i,n,o=t.inputOffset||0,l=new Uint8Array(e,o,10),u=String.fromCharCode.apply(null,l);if("CntZImage"===u.trim())i=r,n=1;else{if("Lerc2"!==u.substring(0,5))throw"Unexpected file identifier string: "+u;i=a,n=2}var c,h,d,f,_,m,g=0,p=e.byteLength-10,y=[],v={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]};while(o<p){var b=i.decode(e,{inputOffset:o,encodedMaskData:c,maskData:d,returnMask:0===g,returnEncodedMask:0===g,returnFileInfo:!0,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null});o=b.fileInfo.eofOffset,0===g&&(c=b.encodedMaskData,d=b.maskData,v.width=b.width,v.height=b.height,v.dimCount=b.dimCount||1,v.pixelType=b.pixelType||b.fileInfo.pixelType,v.mask=b.maskData),n>1&&b.fileInfo.mask&&b.fileInfo.mask.numBytes>0&&y.push(b.maskData),g++,v.pixels.push(b.pixelData),v.statistics.push({minValue:b.minValue,maxValue:b.maxValue,noDataValue:b.noDataValue,dimStats:b.dimStats})}if(n>1&&y.length>1){for(m=v.width*v.height,v.bandMasks=y,d=new Uint8Array(m),d.set(y[0]),f=1;f<y.length;f++)for(h=y[f],_=0;_<m;_++)d[_]=d[_]&h[_];v.maskData=d}return v}};i=[],n=function(){return o}.apply(t,i),void 0===n||(e.exports=n)}()},19853:function(e,t,r){"use strict";r.d(t,{zL:function(){return s}});r(57658);function i(e,t){var r,i=e.length,n=i-t;while(n<--i)r=e[n],e[n++]=e[i],e[i]=r}function n(e){return e}function a(e){if(null==e)return n;var t,r,i=e.scale[0],a=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,n){n||(t=r=0);var l=2,u=e.length,c=new Array(u);c[0]=(t+=e[0])*i+s,c[1]=(r+=e[1])*a+o;while(l<u)c[l]=e[l],++l;return c}}function s(e,t){return"string"===typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return o(e,t)}))}:o(e,t)}function o(e,t){var r=t.id,i=t.bbox,n=null==t.properties?{}:t.properties,a=l(e,t);return null==r&&null==i?{type:"Feature",properties:n,geometry:a}:null==i?{type:"Feature",id:r,properties:n,geometry:a}:{type:"Feature",id:r,bbox:i,properties:n,geometry:a}}function l(e,t){var r=a(e.transform),n=e.arcs;function s(e,t){t.length&&t.pop();for(var a=n[e<0?~e:e],s=0,o=a.length;s<o;++s)t.push(r(a[s],s));e<0&&i(t,o)}function o(e){return r(e)}function l(e){for(var t=[],r=0,i=e.length;r<i;++r)s(e[r],t);return t.length<2&&t.push(t[0]),t}function u(e){var t=l(e);while(t.length<4)t.push(t[0]);return t}function c(e){return e.map(u)}function h(e){var t,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(h)};case"Point":t=o(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(o);break;case"LineString":t=l(e.arcs);break;case"MultiLineString":t=e.arcs.map(l);break;case"Polygon":t=c(e.arcs);break;case"MultiPolygon":t=e.arcs.map(c);break;default:return null}return{type:r,coordinates:t}}return h(t)}r(30541)},28636:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Ce}});var i=r(73396);const n={id:"cesiumContainer"};function a(e,t,r,a,s,o){return(0,i.wg)(),(0,i.iD)("div",n)}var s=r(42891),o=r(46149),l=r(91845),u=(r(57658),r(81807)),c=r(18278),h=r(68798),d=r(56114),f=r(50938),_=r(9984),m=r(71496),g=r(67363),p=r(33876),y=r(57917),v=r(96855),b=r(58957),w=r(82685),x=r(72668),Z=r(36214),P=r(66446),D=r(96288),k=r(15810),I=r(49740),T=r(15193);const U=15;function A(e){if(!(0,d.Z)(e)||!(0,d.Z)(e.url))throw new f.Z("options.url is required.");this._resource=void 0,this._credit=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._maxLevel=void 0,this._terrainDataStructure=void 0,this._ready=!1,this._width=void 0,this._height=void 0,this._encoding=void 0;const t=e.token;this._hasAvailability=!1,this._tilesAvailable=void 0,this._tilesAvailablityLoaded=void 0,this._availableCache={};const r=this,i=(0,h.Z)(e.ellipsoid,_.Z.WGS84);this._readyPromise=Promise.resolve(e.url).then((function(e){let i=Z.Z.createIfNeeded(e);i.appendForwardSlash(),(0,d.Z)(t)&&(i=i.getDerivedResource({queryParameters:{token:t}})),r._resource=i;const n=i.getDerivedResource({queryParameters:{f:"pjson"}});return n.fetchJson()})).then((function(e){const t=e.copyrightText;(0,d.Z)(t)&&(r._credit=new c.Z(t));const n=e.spatialReference,a=(0,h.Z)(n.latestWkid,n.wkid),s=e.extent,o={ellipsoid:i};if(4326===a)o.rectangle=v.Z.fromDegrees(s.xmin,s.ymin,s.xmax,s.ymax),r._tilingScheme=new g.Z(o);else{if(3857!==a)return Promise.reject(new P.Z("Invalid spatial reference"));{const t=Math.PI*i.maximumRadius;e.extent.xmax>t&&(e.extent.xmax=t),e.extent.ymax>t&&(e.extent.ymax=t),e.extent.xmin<-t&&(e.extent.xmin=-t),e.extent.ymin<-t&&(e.extent.ymin=-t),o.rectangleSouthwestInMeters=new u.Z(s.xmin,s.ymin),o.rectangleNortheastInMeters=new u.Z(s.xmax,s.ymax),r._tilingScheme=new T.Z(o)}}const l=e.tileInfo;if(!(0,d.Z)(l))return Promise.reject(new P.Z("tileInfo is required"));r._width=l.rows+1,r._height=l.cols+1,r._encoding="LERC"===l.format?p.Z.LERC:p.Z.NONE,r._lodCount=l.lods.length-1;const f=r._hasAvailability=-1!==e.capabilities.indexOf("Tilemap");return f&&(r._tilesAvailable=new k.Z(r._tilingScheme,r._lodCount),r._tilesAvailable.addAvailableTileRange(0,0,0,r._tilingScheme.getNumberOfXTilesAtLevel(0),r._tilingScheme.getNumberOfYTilesAtLevel(0)),r._tilesAvailablityLoaded=new k.Z(r._tilingScheme,r._lodCount)),r._levelZeroMaximumGeometricError=D.Z.getEstimatedLevelZeroGeometricErrorForAHeightmap(r._tilingScheme.ellipsoid,r._width,r._tilingScheme.getNumberOfXTilesAtLevel(0)),e.bandCount>1&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one."),(0,d.Z)(e.minValues)&&(0,d.Z)(e.maxValues)?r._terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:e.minValues[0],highestEncodedHeight:e.maxValues[0]}:r._terrainDataStructure={elementMultiplier:1},r._ready=!0,!0})).catch((function(e){const t=`An error occurred while accessing ${r._resource.url}.`;return I.Z.reportError(void 0,r,r._errorEvent,t),Promise.reject(e)})),this._errorEvent=new m.Z}function S(e,t,r,i){if(!e._hasAvailability)return;const n=e._tilesAvailablityLoaded,a=e._tilesAvailable;return!(t>e._lodCount)&&(!!a.isTileAvailable(t,r,i)||!n.isTileAvailable(t,r,i)&&void 0)}function M(e,t,r,i){const n=t-1,a=r-1,s=i[e.y*t+e.x],o=[],l={startX:e.x,startY:e.y,endX:0,endY:0},c=new u.Z(e.x+1,e.y+1);let h=!1,d=!1;while(!h||!d){let r=c.x;const f=d?c.y+1:c.y;if(!h){for(let r=e.y;r<f;++r)if(i[r*t+c.x]!==s){h=!0;break}h?(o.push(new u.Z(c.x,e.y)),--c.x,--r,l.endX=c.x):c.x===n?(l.endX=c.x,h=!0):++c.x}if(!d){const n=c.y*t;for(let t=e.x;t<=r;++t)if(i[n+t]!==s){d=!0;break}d?(o.push(new u.Z(e.x,c.y)),--c.y,l.endY=c.y):c.y===a?(l.endY=c.y,d=!0):++c.y}}return{endingIndices:o,range:l,value:s}}function V(e,t,r,i,n){const a=[],s=n.every((function(e){return e===n[0]}));if(s)return 1===n[0]&&a.push({startX:e,startY:t,endX:e+r-1,endY:t+i-1}),a;let o=[new u.Z(0,0)];while(o.length>0){const s=o.pop(),l=M(s,r,i,n);if(1===l.value){const r=l.range;r.startX+=e,r.endX+=e,r.startY+=t,r.endY+=t,a.push(r)}const u=l.endingIndices;u.length>0&&(o=o.concat(u))}return a}function B(e,t,r,i){if(!e._hasAvailability)return{};const n=128*Math.floor(r/128),a=128*Math.floor(i/128),s=Math.min(1<<t,128),o=`tilemap/${t}/${a}/${n}/${s}/${s}`,l=e._availableCache;if((0,d.Z)(l[o]))return l[o];const u=new b.Z({throttle:!1,throttleByServer:!0,type:x.Z.TERRAIN}),c=e._resource.getDerivedResource({url:o,request:u});let h=c.fetchJson();return(0,d.Z)(h)?(h=h.then((function(o){const l=V(n,a,s,s,o.data);e._tilesAvailablityLoaded.addAvailableTileRange(t,n,a,n+s,a+s);const u=e._tilesAvailable;for(let e=0;e<l.length;++e){const r=l[e];u.addAvailableTileRange(t,r.startX,r.startY,r.endX,r.endY)}return S(e,t,r,i)})),l[o]={promise:h,request:u},h=h.finally((function(e){return delete l[o],e})),{promise:h,request:u}):{}}Object.defineProperties(A.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this.ready)throw new f.Z("credit must not be called before ready returns true.");return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new f.Z("tilingScheme must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){if(!this._ready)throw new f.Z("availability must not be called before the terrain provider is ready.");return this._tilesAvailable}}}),A.prototype.requestTileGeometry=function(e,t,r,i){if(!this._ready)throw new f.Z("requestTileGeometry must not be called before the terrain provider is ready.");const n=this._resource.getDerivedResource({url:`tile/${r}/${t}/${e}`,request:i}),a=this._hasAvailability;let s,o=Promise.resolve(!0);if(a&&!(0,d.Z)(S(this,r+1,2*e,2*t))){const i=B(this,r+1,2*e,2*t);o=i.promise,s=i.request}const l=n.fetchArrayBuffer();if(!(0,d.Z)(l)||!(0,d.Z)(o))return;const u=this,c=this._tilesAvailable;return Promise.all([l,o]).then((function(i){return new y.Z({buffer:i[0],width:u._width,height:u._height,childTileMask:a?c.computeChildMaskForTile(r,e,t):U,structure:u._terrainDataStructure,encoding:u._encoding})})).catch((function(e){return(0,d.Z)(s)&&s.state===w.Z.CANCELLED?(i.cancel(),i.deferred.promise.finally((function(){return i.state=w.Z.CANCELLED,Promise.reject(e)}))):Promise.reject(e)}))},A.prototype.getLevelMaximumGeometricError=function(e){if(!this.ready)throw new f.Z("getLevelMaximumGeometricError must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<e)},A.prototype.getTileDataAvailable=function(e,t,r){if(!this._hasAvailability)return;const i=S(this,r,e,t);if((0,d.Z)(i))return i;B(this,r,e,t)},A.prototype.loadTileDataAvailability=function(e,t,r){};var R=A,C=(r(63408),r(14590),r(29043)),F=r(55598),L=r(22761),E=r(29047),O=r(12713),N=r(76377),z=r(16755),G=r(14826),j=r(64680),q=r(68701),X=r(64081),$=r(59904),Y=r(19993),H=r(73502);function J(e,t){this._parent=e,this._dataProvider=e._dataProvider,this._layer=e._layer,(0,d.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${t}`}):this._resource=this._parent.resource.getDerivedResource({url:t})}Object.defineProperties(J.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}}}),J.prototype.load=function(){const e=this;return this._dataProvider._loadJson(this._resource).then((function(t){return e._data=t,t}))};var W=J;function Q(e,t){this._storageInfo=t,this._parent=e,this._dataProvider=e._dataProvider;const r=`attributes/${t.key}/0`;(0,d.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${r}`}):this._resource=this._parent.resource.getDerivedResource({url:r})}function K(e){return"UInt8"===e||"Int8"===e?1:"UInt16"===e||"Int16"===e?2:"UInt32"===e||"Int32"===e||"Oid32"===e||"Float32"===e?4:"UInt64"===e||"Int64"===e||"Float64"===e?8:0}Object.defineProperties(Q.prototype,{resource:{get:function(){return this._resource}},header:{get:function(){return this._header}},values:{get:function(){return(0,d.Z)(this._values)&&(0,d.Z)(this._values.attributeValues)?this._values.attributeValues:[]}},name:{get:function(){return this._storageInfo.name}}}),Q.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){const r=new DataView(t);let i=!0;if(r.getUint8(0)==="{".charCodeAt(0)){const r=new TextDecoder,n=r.decode(t);n.includes("404")&&(i=!1,console.error(`Failed to load: ${e.resource.url}`))}if(i){e._data=t;let i=e._parseHeader(r);const n=K(e._storageInfo.attributeValues.valueType);n>0&&(i=Math.ceil(i/n)*n),e._parseBody(r,i)}}))},Q.prototype._parseValue=function(e,t,r){let i;if("UInt8"===t)i=e.getUint8(r),r+=1;else if("Int8"===t)i=e.getInt8(r),r+=1;else if("UInt16"===t)i=e.getUint16(r,!0),r+=2;else if("Int16"===t)i=e.getInt16(r,!0),r+=2;else if("UInt32"===t)i=e.getUint32(r,!0),r+=4;else if("Oid32"===t)i=e.getUint32(r,!0),r+=4;else if("Int32"===t)i=e.getInt32(r,!0),r+=4;else if("UInt64"===t){const t=e.getUint32(r,!0),n=e.getUint32(r+4,!0);i=t+Math.pow(2,32)*n,r+=8}else if("Int64"===t){const t=e.getUint32(r,!0),n=e.getUint32(r+4,!0);i=n<Math.pow(2,31)?t+Math.pow(2,32)*n:t+Math.pow(2,32)*(n-Math.pow(2,32)),r+=8}else"Float32"===t?(i=e.getFloat32(r,!0),r+=4):"Float64"===t?(i=e.getFloat64(r,!0),r+=8):"String"===t&&(i=String.fromCharCode(e.getUint8(r)),r+=1);return{value:i,offset:r}},Q.prototype._parseHeader=function(e){let t=0;this._header={};for(let r=0;r<this._storageInfo.header.length;r++){const i=this._storageInfo.header[r],n=this._parseValue(e,i.valueType,t);this._header[i.property]=n.value,t=n.offset}return t},Q.prototype._parseBody=function(e,t){this._values={};for(let r=0;r<this._storageInfo.ordering.length;r++){const i=this._storageInfo.ordering[r],n=this._storageInfo[i];if((0,d.Z)(n)){this._values[i]=[];for(let r=0;r<this._header.count;++r)if("String"!==n.valueType){const r=this._parseValue(e,n.valueType,t);this._values[i].push(r.value),t=r.offset}else{const a=this._values.attributeByteCounts[r];let s="";for(let r=0;r<a;++r){const r=this._parseValue(e,n.valueType,t);0!==r.value.charCodeAt(0)&&(s+=r.value),t=r.offset}this._values[i].push(s)}}}};var ee=Q,te=r(63822);function re(e,t){const r=e._dataProvider,i=e._layer;let n;n=(0,d.Z)(e._nodeIndex)?i.resource.getDerivedResource({url:`nodes/${e._data.mesh.geometry.resource}/${t}`}):e.resource.getDerivedResource({url:t}),this._parent=e,this._dataProvider=r,this._layer=i,this._resource=n,this._customAttributes=void 0}Object.defineProperties(re.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},customAttributes:{get:function(){return this._customAttributes}}}),re.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){return e._data=t,t}))};const ie=new te.Z,ne=new te.Z,ae=new te.Z,se=new te.Z,oe=new te.Z;function le(e,t,r,i){const n=te.Z.subtract(i,r,ie),a=te.Z.cross(n,te.Z.subtract(e,r,ne),se),s=te.Z.cross(n,te.Z.subtract(t,r,ae),oe);return te.Z.dot(a,s)>=0}const ue=new te.Z,ce=new te.Z,he=new te.Z,de=new te.Z,fe=new te.Z,_e=new te.Z,me=new te.Z,ge=new te.Z,pe=new te.Z,ye=new te.Z;re.prototype.getClosestPointIndexOnTriangle=function(e,t,r){if((0,d.Z)(this._customAttributes)&&(0,d.Z)(this._customAttributes.positions)){const i=new te.Z(e,t,r);i.x-=this._customAttributes.cartesianCenter.x,i.y-=this._customAttributes.cartesianCenter.y,i.z-=this._customAttributes.cartesianCenter.z,q.Z.multiplyByVector(this._customAttributes.parentRotation,i,i);let n,a,s,o,l=Number.MAX_VALUE;const u=this._customAttributes.positions,c=this._customAttributes.indices;let h;h=(0,d.Z)(c)?c.length:u.length/3;for(let e=0;e<h;e++){let t,r,h;(0,d.Z)(c)?(t=c[e],r=c[e+1],h=c[e+2]):(t=3*e,r=3*e+1,h=3*e+2);const f=te.Z.fromElements(u[3*t],u[3*t+1],u[3*t+2],ue),_=te.Z.fromElements(u[3*r],u[3*r+1],u[3*r+2],ce),m=new te.Z(u[3*h],u[3*h+1],u[3*h+2],he);if(!le(i,f,_,m)||!le(i,_,f,m)||!le(i,m,f,_))continue;const g=te.Z.subtract(_,f,de),p=te.Z.subtract(m,f,fe),y=te.Z.cross(g,p,_e);if(0===te.Z.magnitude(y))continue;const v=te.Z.normalize(y,me),b=te.Z.subtract(i,f,ge),w=Math.abs(te.Z.dot(b,v));if(w<l){l=w,n=e;const u=te.Z.magnitudeSquared(te.Z.subtract(i,f,b)),c=te.Z.magnitudeSquared(te.Z.subtract(i,_,pe)),d=te.Z.magnitudeSquared(te.Z.subtract(i,m,ye));u<c&&u<d?(s=t,o=f,a=u):c<d?(s=r,o=_,a=c):(s=h,o=m,a=d)}}if((0,d.Z)(n))return{index:s,distanceSquared:a,distance:Math.sqrt(a),queriedPosition:i,closestPosition:te.Z.clone(o)}}return{index:-1,distanceSquared:Number.Infinity,distance:Number.Infinity}},re.prototype._generateGltf=function(e,t,r,i,n,a){let s,o={pbrMetallicRoughness:{metallicFactor:0},doubleSided:!0,name:"Material"},l=!1,u="";if((0,d.Z)(this._parent._data.mesh)&&(0,d.Z)(this._layer._data.materialDefinitions)){const e=this._parent._data.mesh.material,t=e.definition;if(t>=0&&t<this._layer._data.materialDefinitions.length&&(s=this._layer._data.materialDefinitions[t],o=s,(0,d.Z)(o.pbrMetallicRoughness)&&(0,d.Z)(o.pbrMetallicRoughness.baseColorTexture))){l=!0,o.pbrMetallicRoughness.baseColorTexture.index=0;let e="0";if((0,d.Z)(this._layer._data.textureSetDefinitions))for(let t=0;t<this._layer._data.textureSetDefinitions.length;t++){const r=this._layer._data.textureSetDefinitions[t];for(let t=0;t<r.formats.length;t++){const i=r.formats[t];if("jpg"===i.format){e=i.name;break}}}(0,d.Z)(this._parent._data.mesh)&&this._parent._data.mesh.material.resource>=0&&(u=this._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.material.resource}/textures/${e}`}).url)}}else(0,d.Z)(this._parent._data.textureData)&&(l=!0,u=this._parent.resource.getDerivedResource({url:`${this._parent._data.textureData[0].href}`}).url,o.pbrMetallicRoughness.baseColorTexture={index:0});let c=[],h=[],f=[];l&&(c=[{sampler:0,source:0}],h=[{uri:u}],f=[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}]);const _={scene:0,scenes:[{nodes:e}],nodes:t,meshes:r,buffers:i,bufferViews:n,accessors:a,materials:[o],textures:c,images:h,samplers:f,asset:{version:"2.0"}};return _};var ve=re;function be(e,t,r){let i,n,a,s;r?(i=0,n=e):(i=e._level+1,n=e._layer),"number"===typeof t?a=t:s=e.resource.getDerivedResource({url:`${t}/`}),this._parent=e,this._dataProvider=e._dataProvider,this._isRoot=r,this._level=i,this._layer=n,this._nodeIndex=a,this._resource=s,this._tile=void 0,this._data=void 0,this._geometryData=[],this._featureData=[],this._fields={},this._children=[],this._childrenReadyPromise=void 0,this._globalTransform=void 0,this._inverseGlobalTransform=void 0,this._inverseRotationMatrix=void 0}function we(e,t,r,i,n,a){const s=r*(1-e)+i*e,o=n*(1-e)+a*e;return s*(1-t)+o*t}function xe(e,t,r,i){const n=e+t*r;return i[n]}function Ze(e,t,r){const i=r.nativeExtent;let n=(e-i.west)/(i.east-i.west)*(r.width-1),a=(t-i.south)/(i.north-i.south)*(r.height-1);const s=Math.floor(n);let o=Math.floor(a);n-=s,a-=o;const l=s<r.width?s+1:s;let u=o<r.height?o+1:o;o=r.height-1-o,u=r.height-1-u;const c=xe(s,o,r.width,r.buffer),h=xe(l,o,r.width,r.buffer),d=xe(s,u,r.width,r.buffer),f=xe(l,u,r.width,r.buffer);let _=we(n,a,c,h,d,f);return _=_*r.scale+r.offset,_}Object.defineProperties(be.prototype,{resource:{get:function(){return this._resource}},layer:{get:function(){return this._layer}},parent:{get:function(){return this._parent}},children:{get:function(){return this._children}},geometryData:{get:function(){return this._geometryData}},featureData:{get:function(){return this._featureData}},fields:{get:function(){return this._fields}},tile:{get:function(){return this._tile}},data:{get:function(){return this._data}}}),be.prototype.load=function(){const e=this;function t(){if(!e._isRoot){const t=e._create3DTileDefinition();e._tile=new H.Z(e._layer._tileset,e._dataProvider.resource,t,e._parent._tile),e._tile._i3sNode=e}}return(0,d.Z)(this._nodeIndex)?this._layer._getNodeInNodePages(this._nodeIndex).then((function(r){let i;if(e._data=r,e._isRoot)i="nodes/root/";else if((0,d.Z)(r.mesh)){const e=r.mesh.geometry.resource;i=`../${e}/`}(0,d.Z)(i)&&(e._resource=e._parent.resource.getDerivedResource({url:i})),t()})):this._dataProvider._loadJson(this._resource).then((function(r){e._data=r,t()}))},be.prototype.loadFields=function(){const e=this._layer._data.attributeStorageInfo,t=this;function r(e,r){const i=new ee(t,e[r]);return t._fields[i._storageInfo.name]=i,i.load()}const i=[];if((0,d.Z)(e))for(let n=0;n<e.length;n++)i.push(r(e,n));return Promise.all(i)},be.prototype.getFieldsForPickedPosition=function(e){const t=this.geometryData[0];if(!(0,d.Z)(t.customAttributes.featureIndex))return{};const r=t.getClosestPointIndexOnTriangle(e.x,e.y,e.z);if(-1===r.index||r.index>t.customAttributes.featureIndex.length)return{};const i=t.customAttributes.featureIndex[r.index];return this.getFieldsForFeature(i)},be.prototype.getFieldsForFeature=function(e){const t={};for(const r in this.fields)if(this.fields.hasOwnProperty(r)){const i=this.fields[r];e>=0&&e<i.values.length&&(t[i.name]=i.values[e])}return t},be.prototype._loadChildren=function(){const e=this;if((0,d.Z)(this._childrenReadyPromise))return this._childrenReadyPromise;const t=[];if((0,d.Z)(e._data.children))for(let r=0;r<e._data.children.length;r++){const i=e._data.children[r],n=new be(e,(0,h.Z)(i.href,i),!1);e._children.push(n),t.push(n.load())}return this._childrenReadyPromise=Promise.all(t).then((function(){for(let t=0;t<e._children.length;t++)e._tile.children.push(e._children[t]._tile)})),this._childrenReadyPromise},be.prototype._loadGeometryData=function(){const e=[];if((0,d.Z)(this._data.geometryData))for(let t=0;t<this._data.geometryData.length;t++){const r=new ve(this,this._data.geometryData[t].href);this._geometryData.push(r),e.push(r.load())}else if((0,d.Z)(this._data.mesh)){const t=this._layer._findBestGeometryBuffers(this._data.mesh.geometry.definition,["position","uv0"]),r=`./geometries/${t.bufferIndex}/`,i=new ve(this,r);i._geometryDefinitions=t.definition,i._geometryBufferInfo=t.geometryBufferInfo,this._geometryData.push(i),e.push(i.load())}return Promise.all(e)},be.prototype._loadFeatureData=function(){const e=[];if((0,d.Z)(this._data.featureData))for(let t=0;t<this._data.featureData.length;t++){const r=new W(this,this._data.featureData[t].href);this._featureData.push(r),e.push(r.load())}return Promise.all(e)},be.prototype._clearGeometryData=function(){this._geometryData=[]},be.prototype._create3DTileDefinition=function(){const e=this._data.obb,t=this._data.mbs;if(!(0,d.Z)(e)&&!(0,d.Z)(t))return void console.error("Failed to load I3S node. Bounding volume is required.");let r;if(r=(0,d.Z)(e)?C.Z.fromDegrees(e.center[0],e.center[1],e.center[2]):C.Z.fromDegrees(t[0],t[1],t[2]),(0,d.Z)(this._dataProvider._geoidDataList)&&(0,d.Z)(r))for(let d=0;d<this._dataProvider._geoidDataList.length;d++){const e=this._dataProvider._geoidDataList[d],t=e.projection.project(r);if(t.x>e.nativeExtent.west&&t.x<e.nativeExtent.east&&t.y>e.nativeExtent.south&&t.y<e.nativeExtent.north){r.height+=Ze(t.x,t.y,e);break}}let i,n={},a=0;(0,d.Z)(e)?(n={box:[0,0,0,e.halfSize[0],0,0,0,e.halfSize[1],0,0,0,e.halfSize[2]]},a=Math.max(Math.max(this._data.obb.halfSize[0],this._data.obb.halfSize[1]),this._data.obb.halfSize[2]),i=_.Z.WGS84.cartographicToCartesian(r)):(n={sphere:[0,0,0,t[3]]},i=_.Z.WGS84.cartographicToCartesian(r),a=this._data.mbs[3]),a*=2;let s=1/0;if((0,d.Z)(this._data.lodThreshold))if("maxScreenThresholdSQ"===this._layer._data.nodePages.lodSelectionMetricType){const e=Math.sqrt(this._data.lodThreshold/(.25*Math.PI));s=a/e}else if("maxScreenThreshold"===this._layer._data.nodePages.lodSelectionMetricType){const e=this._data.lodThreshold;s=a/e}else console.error("Invalid lodSelectionMetricType in Layer");else if((0,d.Z)(this._data.lodSelection))for(let d=0;d<this._data.lodSelection.length;d++)"maxScreenThreshold"===this._data.lodSelection[d].metricType&&(s=a/this._data.lodSelection[d].maxError);s===1/0&&(s=1e5);const o=16*s,l=new G.Z(0,0,0);let u=Y.Z.headingPitchRollQuaternion(i,l);(0,d.Z)(this._data.obb)&&(u=new $.Z(this._data.obb.quaternion[0],this._data.obb.quaternion[1],this._data.obb.quaternion[2],this._data.obb.quaternion[3]));const c=q.Z.fromQuaternion(u),h=q.Z.inverse(c,new q.Z),f=new X.Z(c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,i.x,i.y,i.z,1),m=X.Z.inverse(f,new X.Z),g=X.Z.clone(f);(0,d.Z)(this._parent._globalTransform)&&X.Z.multiply(f,this._parent._inverseGlobalTransform,g),this._globalTransform=f,this._inverseGlobalTransform=m,this._inverseRotationMatrix=h;const p=[];for(let d=0;d<this._children.length;d++)p.push(this._children[d]._create3DTileDefinition());const y={children:p,refine:"REPLACE",boundingVolume:n,transform:[g[0],g[4],g[8],g[12],g[1],g[5],g[9],g[13],g[2],g[6],g[10],g[14],g[3],g[7],g[11],g[15]],content:{uri:(0,d.Z)(this._resource)?this._resource.url:void 0},geometricError:o};return y},be.prototype._createI3SDecoderTask=function(e,t){const r=t.geometryData._parent._data,i=t.geometryData._parent._inverseRotationMatrix;let n=0,a=0,s=0;(0,d.Z)(r.obb)?(n=r.obb.center[0],a=r.obb.center[1],s=r.obb.center[2]):(0,d.Z)(r.mbs)&&(n=r.mbs[0],a=r.mbs[1],s=r.mbs[2]);const o=q.Z.fromRotationX(-j.Z.PI_OVER_TWO),l=new q.Z;q.Z.multiply(o,i,l);const u=C.Z.fromDegrees(n,a,s),c=_.Z.WGS84.cartographicToCartesian(u),h={binaryData:t.geometryData._data,featureData:(0,d.Z)(t.featureData)&&(0,d.Z)(t.featureData[0])?t.featureData[0].data:void 0,schema:t.defaultGeometrySchema,bufferInfo:t.geometryData._geometryBufferInfo,ellipsoidRadiiSquare:_.Z.WGS84.radiiSquared,url:t.url,geoidDataList:t.geometryData._dataProvider._geoidDataList,cartographicCenter:u,cartesianCenter:c,parentRotation:l},f=e._getDecoderTaskProcessor(),m=[];return e._taskProcessorReadyPromise.then((function(){return f.scheduleTask(h,m)}))},be.prototype._createContentURL=function(){let e={scene:0,scenes:[{nodes:[0]}],nodes:[{name:"singleNode"}],meshes:[],buffers:[],bufferViews:[],accessors:[],materials:[],textures:[],images:[],samplers:[],asset:{version:"2.0"}};const t=[this._loadGeometryData()];this._dataProvider.legacyVersion16&&t.push(this._loadFeatureData());const r=this;return Promise.all(t).then((function(){let t=Promise.resolve();if((0,d.Z)(r._geometryData)&&r._geometryData.length>0){const i={geometryData:r._geometryData[0],featureData:r._featureData,defaultGeometrySchema:r._layer._data.store.defaultGeometrySchema,url:r._geometryData[0].resource.url,tile:r._tile},n=r._createI3SDecoderTask(r._dataProvider,i);if(!(0,d.Z)(n))return;t=n.then((function(t){e=i.geometryData._generateGltf(t.meshData.nodesInScene,t.meshData.nodes,t.meshData.meshes,t.meshData.buffers,t.meshData.bufferViews,t.meshData.accessors),r._geometryData[0]._customAttributes=t.meshData._customAttributes}))}return t.then((function(){const t=r._dataProvider._binarizeGltf(e),i=new Blob([t],{type:"application/binary"});r._glbURL=URL.createObjectURL(i)}))}))},H.Z.prototype._hookedRequestContent=H.Z.prototype.requestContent,H.Z.prototype._resolveHookedObject=function(){const e=this;this._hookedRequestContent(),this._contentReadyToProcessPromise.then((function(){e._contentReadyToProcessDefer.resolve()})),this._contentReadyPromise.then((function(t){e._isLoading=!1,e._contentReadyDefer.resolve(t)}))},H.Z.prototype.requestContent=function(){const e=this;return this.tileset._isI3STileSet?this._isLoading?1:(this._isLoading=!0,this._contentReadyToProcessDefer=(0,z.Z)(),this._contentReadyDefer=(0,z.Z)(),this._contentReadyToProcessPromise=this._contentReadyToProcessDefer.promise,this._contentReadyPromise=this._contentReadyDefer.promise,this._i3sNode._createContentURL().then((function(){e._contentResource=new Z.Z({url:e._i3sNode._glbURL}),e._resolveHookedObject()})),0):this._hookedRequestContent()},Object.defineProperties(H.Z.prototype,{i3sNode:{get:function(){return this._i3sNode}}});var Pe=be;function De(e,t,r){this._dataProvider=e,(0,d.Z)(t.href)||(t.href=`./layers/${r}`);const i=this._dataProvider.resource.getUrlComponent();let n="";n=i.match(/layers\/\d/)?`${i}`.replace(/\/+$/,""):`${i}`.replace(/\/?$/,"/").concat(`${t.href}`),this._version=t.store.version;const a=this._version.split(".");this._majorVersion=parseInt(a[0]),this._minorVersion=a.length>1?parseInt(a[1]):0,this._resource=new Z.Z({url:n}),this._resource.setQueryParameters(this._dataProvider.resource.queryParameters),this._resource.appendForwardSlash(),this._data=t,this._rootNode=void 0,this._nodePages={},this._nodePageFetches={},this._extent=void 0,this._tileset=void 0,this._geometryDefinitions=void 0,this._computeGeometryDefinitions(!0),this._computeExtent()}Object.defineProperties(De.prototype,{resource:{get:function(){return this._resource}},rootNode:{get:function(){return this._rootNode}},tileset:{get:function(){return this._tileset}},data:{get:function(){return this._data}},version:{get:function(){return this._version}},majorVersion:{get:function(){return this._majorVersion}},minorVersion:{get:function(){return this._minorVersion}},legacyVersion16:{get:function(){if((0,d.Z)(this.version))return this.majorVersion<1||1===this.majorVersion&&this.minorVersion<=6}}}),De.prototype.load=function(){const e=this;return 4326!==this._data.spatialReference.wkid?(console.log(`Unsupported spatial reference: ${this._data.spatialReference.wkid}`),Promise.reject()):this._dataProvider._geoidDataIsReadyPromise.then((function(){return e._loadRootNode().then((function(){return e._create3DTileset(),e._tileset.readyPromise.then((function(){if(e._rootNode._tile=e._tileset._root,e._tileset._root._i3sNode=e._rootNode,e.legacyVersion16)return e._rootNode._loadChildren()}))}))}))},De.prototype._computeGeometryDefinitions=function(e){if(this._geometryDefinitions=[],(0,d.Z)(this._data.geometryDefinitions))for(let t=0;t<this._data.geometryDefinitions.length;t++){const r=[],i=this._data.geometryDefinitions[t].geometryBuffers;for(let t=0;t<i.length;t++){const n=i[t],a=[];let s=!1;if((0,d.Z)(n.compressedAttributes)&&e){s=!0;const e=n.compressedAttributes.attributes;for(let t=0;t<e.length;t++)a.push(e[t])}else for(const e in n)"offset"!==e&&a.push(e);r.push({compressed:s,attributes:a,index:i.indexOf(n)})}r.sort((function(e,t){return e.compressed&&!t.compressed?-1:!e.compressed&&t.compressed?1:e.attributes.length-t.attributes.length})),this._geometryDefinitions.push(r)}},De.prototype._findBestGeometryBuffers=function(e,t){const r=this._geometryDefinitions[e];if((0,d.Z)(r))for(let i=0;i<r.length;++i){const e=r[i];let n=!1;const a=e.attributes;for(let r=0;r<t.length;r++)if(!a.includes(t[r])){n=!0;break}if(!n)return{bufferIndex:e.index,definition:r,geometryBufferInfo:e}}return 0},De.prototype._loadRootNode=function(){if((0,d.Z)(this._data.nodePages)){let e=0;(0,d.Z)(this._data.nodePages.rootIndex)&&(e=this._data.nodePages.rootIndex),this._rootNode=new Pe(this,e,!0)}else this._rootNode=new Pe(this,this._data.store.rootNode,!0);return this._rootNode.load()},De.prototype._getNodeInNodePages=function(e){const t=Math.floor(e/this._data.nodePages.nodesPerPage),r=e%this._data.nodePages.nodesPerPage,i=this;return this._loadNodePage(t).then((function(){return i._nodePages[t][r]}))},De._fetchJson=function(e){return e.fetchJson()},De.prototype._loadNodePage=function(e){const t=this;if(!(0,d.Z)(this._nodePageFetches[e])){const r=this.resource.getDerivedResource({url:`nodepages/${e}/`}),i=De._fetchJson(r).then((function(r){return(0,d.Z)(r.error)&&200!==r.error.code?Promise.reject(r.error):(t._nodePages[e]=r.nodes,r)}));this._nodePageFetches[e]=i}return this._nodePageFetches[e]},De.prototype._computeExtent=function(){(0,d.Z)(this._data.fullExtent)?this._extent=v.Z.fromDegrees(this._data.fullExtent.xmin,this._data.fullExtent.ymin,this._data.fullExtent.xmax,this._data.fullExtent.ymax):(0,d.Z)(this._data.store.extent)&&(this._extent=v.Z.fromDegrees(this._data.store.extent[0],this._data.store.extent[1],this._data.store.extent[2],this._data.store.extent[3]))},De.prototype._create3DTileset=function(){const e={asset:{version:"1.0"},geometricError:Number.MAX_VALUE,root:this._rootNode._create3DTileDefinition()},t=new Blob([JSON.stringify(e)],{type:"application/json"}),r=URL.createObjectURL(t),i={};if((0,d.Z)(this._dataProvider._cesium3dTilesetOptions))for(const a in this._dataProvider._cesium3dTilesetOptions)this._dataProvider._cesium3dTilesetOptions.hasOwnProperty(a)&&(i[a]=this._dataProvider._cesium3dTilesetOptions[a]);i.url=r,i.show=this._dataProvider.show,this._tileset=new N.Z(i),this._tileset._isI3STileSet=!0;const n=this;this._tileset.readyPromise.then((function(){n._tileset.tileUnload.addEventListener((function(e){e._i3sNode._clearGeometryData(),URL.revokeObjectURL(e._contentResource._url),e._contentResource=e._i3sNode.resource})),n._tileset.tileVisible.addEventListener((function(e){(0,d.Z)(e._i3sNode)&&e._i3sNode._loadChildren()}))}))};var ke=De,Ie=r(7944);function Te(e){e=(0,h.Z)(e,h.Z.EMPTY_OBJECT),F.Z.defined("options.url",e.url),this._resource=Z.Z.createIfNeeded(e.url),this._name=e.name,this._show=(0,h.Z)(e.show,!0),this._geoidTiledTerrainProvider=e.geoidTiledTerrainProvider,this._traceFetches=(0,h.Z)(e.traceFetches,!1),this._cesium3dTilesetOptions=(0,h.Z)(e.cesium3dTilesetOptions,h.Z.EMPTY_OBJECT),this._layers=[],this._data=void 0,this._extent=void 0,this._geoidDataIsReadyPromise=void 0,this._geoidDataList=void 0,this._decoderTaskProcessor=void 0,this._readyPromise=void 0,this._ready=!1,this._load()}function Ue(e,t){return e.readyPromise.then((function(){return Se(e,t)}))}Object.defineProperties(Te.prototype,{name:{get:function(){return this._name}},show:{get:function(){return this._show},set:function(e){F.Z.defined("value",e),this._show=e;for(let t=0;t<this._layers.length;t++)(0,d.Z)(this._layers[t]._tileset)&&(this._layers[t]._tileset.show=this._show)}},traceFetches:{get:function(){return this._traceFetches},set:function(e){F.Z.defined("value",e),this._traceFetches=e}},geoidTiledTerrainProvider:{get:function(){return this._geoidTiledTerrainProvider}},layers:{get:function(){if(!this.ready)throw new f.Z("The dataset is not loaded. Use I3SDataProvider.readyPromise or wait for I3SDataProvider.ready to be true.");return this._layers}},data:{get:function(){if(!this.ready)throw new f.Z("The dataset is not loaded. Use I3SDataProvider.readyPromise or wait for I3SDataProvider.ready to be true.");return this._data}},extent:{get:function(){if(!this.ready)throw new f.Z("The dataset is not loaded. Use I3SDataProvider.readyPromise or wait for I3SDataProvider.ready to be true.");return this._extent}},readyPromise:{get:function(){return this._readyPromise}},ready:{get:function(){return this._ready}},resource:{get:function(){return this._resource}}}),Te.prototype.destroy=function(){for(let e=0;e<this._layers.length;e++)(0,d.Z)(this._layers[e]._tileset)&&this._layers[e]._tileset.destroy();return(0,L.Z)(this)},Te.prototype.isDestroyed=function(){return!1},Te.prototype.update=function(e){for(let t=0;t<this._layers.length;t++)(0,d.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.ready&&this._layers[t]._tileset.update(e)},Te.prototype.prePassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,d.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.ready&&this._layers[t]._tileset.prePassesUpdate(e)},Te.prototype.postPassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,d.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.ready&&this._layers[t]._tileset.postPassesUpdate(e)},Te.prototype.updateForPass=function(e,t){for(let r=0;r<this._layers.length;r++)(0,d.Z)(this._layers[r]._tileset)&&this._layers[r]._tileset.ready&&this._layers[r]._tileset.updateForPass(e,t)},Te.prototype._load=function(){const e=this;return this._readyPromise=this._loadJson(this._resource).then((function(t){if(e._data=t,(0,d.Z)(e._data.layers))for(let i=0;i<e._data.layers.length;i++){const t=new ke(e,e._data.layers[i],i);e._layers.push(t)}else{const t=new ke(e,e._data,e._data.id);e._layers.push(t)}e._computeExtent(),e._loadGeoidData();const r=[];for(let i=0;i<e._layers.length;i++)r.push(e._layers[i].load());return Promise.all(r).then((function(){return e._ready=!0,e}))})),this._readyPromise},Te._fetchJson=function(e){return e.fetchJson()},Te.prototype._loadJson=function(e){return this._traceFetches&&console.log("I3S FETCH:",e.url),Te._fetchJson(e).then((function(t){if((0,d.Z)(t.error)){if(console.error("Failed to fetch I3S ",e.url),(0,d.Z)(t.error.message)&&console.error(t.error.message),(0,d.Z)(t.error.details))for(let e=0;e<t.error.details.length;e++)console.log(t.error.details[e]);return Promise.reject(t.error)}return t}))},Te.prototype._loadBinary=function(e){return this._traceFetches&&console.log("I3S FETCH:",e.url),e.fetchArrayBuffer()},Te.prototype._binarizeGltf=function(e){const t=new TextEncoder,r=t.encode(JSON.stringify(e)),i=new Uint8Array(r.byteLength+20),n={magic:new Uint8Array(i.buffer,0,4),version:new Uint32Array(i.buffer,4,1),length:new Uint32Array(i.buffer,8,1),chunkLength:new Uint32Array(i.buffer,12,1),chunkType:new Uint32Array(i.buffer,16,1),chunkData:new Uint8Array(i.buffer,20,r.byteLength)};return n.magic[0]="g".charCodeAt(),n.magic[1]="l".charCodeAt(),n.magic[2]="T".charCodeAt(),n.magic[3]="F".charCodeAt(),n.version[0]=2,n.length[0]=i.byteLength,n.chunkLength[0]=r.byteLength,n.chunkType[0]=1313821514,n.chunkData.set(r),i},Te.prototype._getDecoderTaskProcessor=function(){if(!(0,d.Z)(this._decoderTaskProcessor)){const e=new E.Z("decodeI3S");this._taskProcessorReadyPromise=e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_decoder_nodejs.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}),this._decoderTaskProcessor=e}return this._decoderTaskProcessor};const Ae=new u.Z;function Se(e,t){const r=e.tilingScheme,i=[],n={},a=e._lodCount,s=C.Z.fromRadians(t.west,t.north),o=C.Z.fromRadians(t.east,t.south),l=r.positionToTileXY(s,a),c=r.positionToTileXY(o,a);for(let d=l.x;d<=c.x;d++)for(let t=l.y;t<=c.y;t++){const s=u.Z.fromElements(d,t,Ae),o=s.toString();if(!n.hasOwnProperty(o)){const t={x:s.x,y:s.y,level:a,tilingScheme:r,terrainProvider:e,positions:[]};n[o]=t,i.push(t)}}const h=[];for(let u=0;u<i.length;++u){const e=i[u],t=e.terrainProvider.requestTileGeometry(e.x,e.y,e.level);h.push(t)}return Promise.all(h).then((function(e){const t=[];for(let n=0;n<e.length;n++){const a={tilingScheme:r,x:i[n].x,y:i[n].y,level:i[n].level},s=e[n];let o="Geographic";r._projection instanceof O.Z&&(o="WebMercator");const l={projectionType:o,projection:r._projection,nativeExtent:r.tileXYToNativeRectangle(a.x,a.y,a.level),height:s._height,width:s._width,scale:s._structure.heightScale,offset:s._structure.heightOffset};if(s._encoding===p.Z.LERC){const e=Ie.decode(s._buffer);l.buffer=e.pixels[0]}else l.buffer=s._buffer;t.push(l)}return t}))}Te.prototype._loadGeoidData=function(){const e=this,t=this._geoidTiledTerrainProvider;return(0,d.Z)(t)?(this._geoidDataIsReadyPromise=t.readyPromise.then((function(){const r=Ue(t,e._extent);return r.then((function(t){e._geoidDataList=t}))})),this._geoidDataIsReadyPromise):(console.log("No Geoid Terrain service provided - no geoid conversion will be performed."),this._geoidDataIsReadyPromise=Promise.resolve(),this._geoidDataIsReadyPromise)},Te.prototype._computeExtent=function(){let e;for(let t=0;t<this._layers.length;t++)if((0,d.Z)(this._layers[t]._extent)){const r=this._layers[t]._extent;(0,d.Z)(e)?v.Z.union(e,r,e):e=v.Z.clone(r)}this._extent=e};var Me=Te,Ve=(r(13226),{mounted(){this.init()},methods:{init(){const e=new s.Z("cesiumContainer",{terrainProvider:o.Z(),animation:!1,timeline:!1});l.Z.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio),e.scene.postProcessStages.fxaa.enabled=!0,e.scene.debugShowFramesPerSecond=!0;const t=new R({url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/EGM2008/ImageServer"}),r={},i={url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_3DObjects_1_7/SceneServer/layers/0",traceFetches:!1,geoidTiledTerrainProvider:t,cesium3dTilesetOptions:r},n=new Me(i);n.readyPromise.then((function(){const t=v.Z.center(n.extent);t.height=1e4,e.camera.setView({destination:_.Z.WGS84.cartographicToCartesian(t)})})),e.scene.primitives.add(n)}}}),Be=r(40089);const Re=(0,Be.Z)(Ve,[["render",a],["__scopeId","data-v-81392638"]]);var Ce=Re}}]);
//# sourceMappingURL=873.c2ee7055.js.map