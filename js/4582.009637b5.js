(self["webpackChunkwebgis"]=self["webpackChunkwebgis"]||[]).push([[4582],{7944:function(e,t,r){var i,n;r(63408),r(14590),r(30541),r(57658),
/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
function(){var r=function(){var e={defaultNoDataValue:-34027999387901484e22,decode:function(a,s){s=s||{};var o=s.encodedMaskData||null===s.encodedMaskData,l=n(a,s.inputOffset||0,o),u=null!==s.noDataValue?s.noDataValue:e.defaultNoDataValue,c=t(l,s.pixelType||Float32Array,s.encodedMaskData,u,s.returnMask),d={width:l.width,height:l.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:l.pixels.maxValue,noDataValue:u};return c.resultMask&&(d.maskData=c.resultMask),s.returnEncodedMask&&l.mask&&(d.encodedMaskData=l.mask.bitset?l.mask.bitset:null),s.returnFileInfo&&(d.fileInfo=r(l),s.computeUsedBitDepths&&(d.fileInfo.bitDepths=i(l))),d}},t=function(e,t,r,i,n){var s,o,l,u=0,c=e.pixels.numBlocksX,d=e.pixels.numBlocksY,h=Math.floor(e.width/c),f=Math.floor(e.height/d),m=2*e.maxZError,g=Number.MAX_VALUE;r=r||(e.mask?e.mask.bitset:null),o=new t(e.width*e.height),n&&r&&(l=new Uint8Array(e.width*e.height));for(var _,p,y=new Float32Array(h*f),v=0;v<=d;v++){var w=v!==d?f:e.height%d;if(0!==w)for(var b=0;b<=c;b++){var x=b!==c?h:e.width%c;if(0!==x){var Z,P,D,k,I=v*e.width*f+b*h,T=e.width-x,S=e.pixels.blocks[u];if(S.encoding<2?(0===S.encoding?Z=S.rawData:(a(S.stuffedData,S.bitsPerPixel,S.numValidPixels,S.offset,m,y,e.pixels.maxValue),Z=y),P=0):D=2===S.encoding?0:S.offset,r)for(p=0;p<w;p++){for(7&I&&(k=r[I>>3],k<<=7&I),_=0;_<x;_++)7&I||(k=r[I>>3]),128&k?(l&&(l[I]=1),s=S.encoding<2?Z[P++]:D,g=g>s?s:g,o[I++]=s):(l&&(l[I]=0),o[I++]=i),k<<=1;I+=T}else if(S.encoding<2)for(p=0;p<w;p++){for(_=0;_<x;_++)s=Z[P++],g=g>s?s:g,o[I++]=s;I+=T}else for(g=g>D?D:g,p=0;p<w;p++){for(_=0;_<x;_++)o[I++]=D;I+=T}if(1===S.encoding&&P!==S.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:o,resultMask:l,minValue:g}},r=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},i=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,r={},i=0;i<t;i++){var n=e.pixels.blocks[i];0===n.encoding?r.float32=!0:1===n.encoding?r[n.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},n=function(e,t,r){var i={},n=new Uint8Array(e,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var a=new DataView(e,t,24);if(i.fileVersion=a.getInt32(0,!0),i.imageType=a.getInt32(4,!0),i.height=a.getUint32(8,!0),i.width=a.getUint32(12,!0),i.maxZError=a.getFloat64(16,!0),t+=24,!r)if(a=new DataView(e,t,16),i.mask={},i.mask.numBlocksY=a.getUint32(0,!0),i.mask.numBlocksX=a.getUint32(4,!0),i.mask.numBytes=a.getUint32(8,!0),i.mask.maxValue=a.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var s=new Uint8Array(Math.ceil(i.width*i.height/8));a=new DataView(e,t,i.mask.numBytes);var o=a.getInt16(0,!0),l=2,u=0;do{if(o>0)while(o--)s[u++]=a.getUint8(l++);else{var c=a.getUint8(l++);o=-o;while(o--)s[u++]=c}o=a.getInt16(l,!0),l+=2}while(l<i.mask.numBytes);if(-32768!==o||u<s.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=s,t+=i.mask.numBytes}else 0===(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));a=new DataView(e,t,16),i.pixels={},i.pixels.numBlocksY=a.getUint32(0,!0),i.pixels.numBlocksX=a.getUint32(4,!0),i.pixels.numBytes=a.getUint32(8,!0),i.pixels.maxValue=a.getFloat32(12,!0),t+=16;var d=i.pixels.numBlocksX,h=i.pixels.numBlocksY,f=d+(i.width%d>0?1:0),m=h+(i.height%h>0?1:0);i.pixels.blocks=new Array(f*m);for(var g=0,_=0;_<m;_++)for(var p=0;p<f;p++){var y=0,v=e.byteLength-t;a=new DataView(e,t,Math.min(10,v));var w={};i.pixels.blocks[g++]=w;var b=a.getUint8(0);if(y++,w.encoding=63&b,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==b&&2!==b){if(b>>=6,w.offsetType=b,2===b)w.offset=a.getInt8(1),y++;else if(1===b)w.offset=a.getInt16(1,!0),y+=2;else{if(0!==b)throw"Invalid block offset type";w.offset=a.getFloat32(1,!0),y+=4}if(1===w.encoding)if(b=a.getUint8(y),y++,w.bitsPerPixel=63&b,b>>=6,w.numValidPixelsType=b,2===b)w.numValidPixels=a.getUint8(y),y++;else if(1===b)w.numValidPixels=a.getUint16(y,!0),y+=2;else{if(0!==b)throw"Invalid valid pixel count type";w.numValidPixels=a.getUint32(y,!0),y+=4}}var x,Z;if(t+=y,3!==w.encoding)if(0===w.encoding){var P=(i.pixels.numBytes-1)/4;if(P!==Math.floor(P))throw"uncompressed block has invalid length";x=new ArrayBuffer(4*P),Z=new Uint8Array(x),Z.set(new Uint8Array(e,t,4*P));var D=new Float32Array(x);w.rawData=D,t+=4*P}else if(1===w.encoding){var k=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),I=Math.ceil(k/4);x=new ArrayBuffer(4*I),Z=new Uint8Array(x),Z.set(new Uint8Array(e,t,k)),w.stuffedData=new Uint32Array(x),t+=k}}else t++}return i.eofOffset=t,i},a=function(e,t,r,i,n,a,s){var o,l,u,c=(1<<t)-1,d=0,h=0,f=Math.ceil((s-i)/n),m=4*e.length-Math.ceil(t*r/8);for(e[e.length-1]<<=8*m,o=0;o<r;o++){if(0===h&&(u=e[d++],h=32),h>=t)l=u>>>h-t&c,h-=t;else{var g=t-h;l=(u&c)<<g&c,u=e[d++],h=32-g,l+=u>>>h}a[o]=l<f?i+l*n:s}return a};return e}(),a=function(){"use strict";var e={unstuff:function(e,t,r,i,n,a,s,o){var l,u,c,d,h,f=(1<<r)-1,m=0,g=0,_=4*e.length-Math.ceil(r*i/8);if(e[e.length-1]<<=8*_,n)for(l=0;l<i;l++)0===g&&(c=e[m++],g=32),g>=r?(u=c>>>g-r&f,g-=r):(d=r-g,u=(c&f)<<d&f,c=e[m++],g=32-d,u+=c>>>g),t[l]=n[u];else for(h=Math.ceil((o-a)/s),l=0;l<i;l++)0===g&&(c=e[m++],g=32),g>=r?(u=c>>>g-r&f,g-=r):(d=r-g,u=(c&f)<<d&f,c=e[m++],g=32-d,u+=c>>>g),t[l]=u<h?a+u*s:o},unstuffLUT:function(e,t,r,i,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,d=0,h=0,f=[],m=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*m;var g=Math.ceil((a-i)/n);for(u=0;u<r;u++)0===d&&(s=e[l++],d=32),d>=t?(h=s>>>d-t&o,d-=t):(c=t-d,h=(s&o)<<c&o,s=e[l++],d=32-c,h+=s>>>d),f[u]=h<g?i+h*n:a;return f.unshift(i),f},unstuff2:function(e,t,r,i,n,a,s,o){var l,u,c,d,h=(1<<r)-1,f=0,m=0,g=0;if(n)for(l=0;l<i;l++)0===m&&(c=e[f++],m=32,g=0),m>=r?(u=c>>>g&h,m-=r,g+=r):(d=r-m,u=c>>>g&h,c=e[f++],m=32-d,u|=(c&(1<<d)-1)<<r-d,g=d),t[l]=n[u];else{var _=Math.ceil((o-a)/s);for(l=0;l<i;l++)0===m&&(c=e[f++],m=32,g=0),m>=r?(u=c>>>g&h,m-=r,g+=r):(d=r-m,u=c>>>g&h,c=e[f++],m=32-d,u|=(c&(1<<d)-1)<<r-d,g=d),t[l]=u<_?a+u*s:o}return t},unstuffLUT2:function(e,t,r,i,n,a){var s,o=(1<<t)-1,l=0,u=0,c=0,d=0,h=0,f=0,m=[],g=Math.ceil((a-i)/n);for(u=0;u<r;u++)0===d&&(s=e[l++],d=32,f=0),d>=t?(h=s>>>f&o,d-=t,f+=t):(c=t-d,h=s>>>f&o,s=e[l++],d=32-c,h|=(s&(1<<c)-1)<<t-c,f=c),m[u]=h<g?i+h*n:a;return m.unshift(i),m},originalUnstuff:function(e,t,r,i){var n,a,s,o,l=(1<<r)-1,u=0,c=0,d=4*e.length-Math.ceil(r*i/8);for(e[e.length-1]<<=8*d,n=0;n<i;n++)0===c&&(s=e[u++],c=32),c>=r?(a=s>>>c-r&l,c-=r):(o=r-c,a=(s&l)<<o&l,s=e[u++],c=32-o,a+=s>>>c),t[n]=a;return t},originalUnstuff2:function(e,t,r,i){var n,a,s,o,l=(1<<r)-1,u=0,c=0,d=0;for(n=0;n<i;n++)0===c&&(s=e[u++],c=32,d=0),c>=r?(a=s>>>d&l,c-=r,d+=r):(o=r-c,a=s>>>d&l,s=e[u++],c=32-o,a|=(s&(1<<o)-1)<<r-o,d=o),t[n]=a;return t}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var t=65535,r=65535,i=e.length,n=Math.floor(i/2),a=0;while(n){var s=n>=359?359:n;n-=s;do{t+=e[a++]<<8,r+=t+=e[a++]}while(--s);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&i&&(r+=t+=e[a]<<8),t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16),(r<<16|t)>>>0},readHeaderInfo:function(e,t){var r=t.ptr,i=new Uint8Array(e,r,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,i),0!==n.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;r+=6;var a,s,o=new DataView(e,r,8),l=o.getInt32(0,!0);if(n.fileVersion=l,r+=4,l>=3&&(n.checksum=o.getUint32(4,!0),r+=4),o=new DataView(e,r,12),n.height=o.getUint32(0,!0),n.width=o.getUint32(4,!0),r+=8,l>=4?(n.numDims=o.getUint32(8,!0),r+=4):n.numDims=1,o=new DataView(e,r,40),n.numValidPixel=o.getUint32(0,!0),n.microBlockSize=o.getInt32(4,!0),n.blobSize=o.getInt32(8,!0),n.imageType=o.getInt32(12,!0),n.maxZError=o.getFloat64(16,!0),n.zMin=o.getFloat64(24,!0),n.zMax=o.getFloat64(32,!0),r+=40,t.headerInfo=n,t.ptr=r,l>=3&&(s=l>=4?52:48,a=this.computeChecksumFletcher32(new Uint8Array(e,r-s,n.blobSize-14)),a!==n.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,i=this.getDataTypeArray(r.imageType),n=r.numDims*this.getDataTypeSize(r.imageType),a=this.readSubArray(e,t.ptr,i,n),s=this.readSubArray(e,t.ptr+n,i,n);t.ptr+=2*n;var o,l=!0;for(o=0;o<r.numDims;o++)if(a[o]!==s[o]){l=!1;break}return r.minValues=a,r.maxValues=s,l},readSubArray:function(e,t,r,i){var n;if(r===Uint8Array)n=new Uint8Array(e,t,i);else{var a=new ArrayBuffer(i),s=new Uint8Array(a);s.set(new Uint8Array(e,t,i)),n=new r(a)}return n},readMask:function(e,t){var r,i,n=t.ptr,a=t.headerInfo,s=a.width*a.height,o=a.numValidPixel,l=new DataView(e,n,4),u={};if(u.numBytes=l.getUint32(0,!0),n+=4,(0===o||s===o)&&0!==u.numBytes)throw"invalid mask";if(0===o)r=new Uint8Array(Math.ceil(s/8)),u.bitset=r,i=new Uint8Array(s),t.pixels.resultMask=i,n+=u.numBytes;else if(u.numBytes>0){r=new Uint8Array(Math.ceil(s/8)),l=new DataView(e,n,u.numBytes);var c=l.getInt16(0,!0),d=2,h=0,f=0;do{if(c>0)while(c--)r[h++]=l.getUint8(d++);else{f=l.getUint8(d++),c=-c;while(c--)r[h++]=f}c=l.getInt16(d,!0),d+=2}while(d<u.numBytes);if(-32768!==c||h<r.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(s);var m=0,g=0;for(g=0;g<s;g++)7&g?(m=r[g>>3],m<<=7&g):m=r[g>>3],128&m&&(i[g]=1);t.pixels.resultMask=i,u.bitset=r,n+=u.numBytes}return t.ptr=n,t.mask=u,!0},readDataOneSweep:function(e,r,i){var n,a=r.ptr,s=r.headerInfo,o=s.numDims,l=s.width*s.height,u=s.imageType,c=s.numValidPixel*t.getDataTypeSize(u)*o,d=r.pixels.resultMask;if(i===Uint8Array)n=new Uint8Array(e,a,c);else{var h=new ArrayBuffer(c),f=new Uint8Array(h);f.set(new Uint8Array(e,a,c)),n=new i(h)}if(n.length===l*o)r.pixels.resultPixels=n;else{r.pixels.resultPixels=new i(l*o);var m=0,g=0,_=0,p=0;if(o>1)for(_=0;_<o;_++)for(p=_*l,g=0;g<l;g++)d[g]&&(r.pixels.resultPixels[p+g]=n[m++]);else for(g=0;g<l;g++)d[g]&&(r.pixels.resultPixels[g]=n[m++])}return a+=c,r.ptr=a,!0},readHuffmanTree:function(e,i){var n=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(e,i.ptr,16);i.ptr+=16;var s=a.getInt32(0,!0);if(s<2)throw"unsupported Huffman version";var o=a.getInt32(4,!0),l=a.getInt32(8,!0),u=a.getInt32(12,!0);if(l>=u)return!1;var c=new Uint32Array(u-l);t.decodeBits(e,i,c);var d,h,f,m,g=[];for(d=l;d<u;d++)h=d-(d<o?0:o),g[h]={first:c[d-l],second:null};var _=e.byteLength-i.ptr,p=Math.ceil(_/4),y=new ArrayBuffer(4*p),v=new Uint8Array(y);v.set(new Uint8Array(e,i.ptr,_));var w,b=new Uint32Array(y),x=0,Z=0;for(w=b[0],d=l;d<u;d++)h=d-(d<o?0:o),m=g[h].first,m>0&&(g[h].second=w<<x>>>32-m,32-x>=m?(x+=m,32===x&&(x=0,Z++,w=b[Z])):(x+=m-32,Z++,w=b[Z],g[h].second|=w>>>32-x));var P=0,D=0,k=new r;for(d=0;d<g.length;d++)void 0!==g[d]&&(P=Math.max(P,g[d].first));D=P>=n?n:P,P>=30&&console.log("WARning, large NUM LUT BITS IS "+P);var I,T,S,A,U,M,V=[];for(d=l;d<u;d++)if(h=d-(d<o?0:o),m=g[h].first,m>0)if(I=[m,h],m<=D)for(T=g[h].second<<D-m,S=1<<D-m,f=0;f<S;f++)V[T|f]=I;else for(T=g[h].second,M=k,A=m-1;A>=0;A--)U=T>>>A&1,U?(M.right||(M.right=new r),M=M.right):(M.left||(M.left=new r),M=M.left),0!==A||M.val||(M.val=I[1]);return{decodeLut:V,numBitsLUTQick:D,numBitsLUT:P,tree:k,stuffedData:b,srcPtr:Z,bitPos:x}},readHuffman:function(e,t,r){var i,n,a,s,o,l,u,c,d,h,f=t.headerInfo,m=f.numDims,g=t.headerInfo.height,_=t.headerInfo.width,p=_*g,y=this.readHuffmanTree(e,t),v=y.decodeLut,w=y.tree,b=y.stuffedData,x=y.srcPtr,Z=y.bitPos,P=y.numBitsLUTQick,D=y.numBitsLUT,k=0===t.headerInfo.imageType?128:0,I=t.pixels.resultMask,T=0;Z>0&&(x++,Z=0);var S,A=b[x],U=1===t.encodeMode,M=new r(p*m),V=M;for(S=0;S<f.numDims;S++){if(m>1&&(V=new r(M.buffer,p*S,p),T=0),t.headerInfo.numValidPixel===_*g)for(d=0,u=0;u<g;u++)for(c=0;c<_;c++,d++){if(n=0,s=A<<Z>>>32-P,o=s,32-Z<P&&(s|=b[x+1]>>>64-Z-P,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=A<<Z>>>32-D,o=s,32-Z<D&&(s|=b[x+1]>>>64-Z-D,o=s),i=w,h=0;h<D;h++)if(l=s>>>D-h-1&1,i=l?i.right:i.left,!i.left&&!i.right){n=i.val,Z=Z+h+1;break}Z>=32&&(Z-=32,x++,A=b[x]),a=n-k,U?(a+=c>0?T:u>0?V[d-_]:T,a&=255,V[d]=a,T=a):V[d]=a}else for(d=0,u=0;u<g;u++)for(c=0;c<_;c++,d++)if(I[d]){if(n=0,s=A<<Z>>>32-P,o=s,32-Z<P&&(s|=b[x+1]>>>64-Z-P,o=s),v[o])n=v[o][1],Z+=v[o][0];else for(s=A<<Z>>>32-D,o=s,32-Z<D&&(s|=b[x+1]>>>64-Z-D,o=s),i=w,h=0;h<D;h++)if(l=s>>>D-h-1&1,i=l?i.right:i.left,!i.left&&!i.right){n=i.val,Z=Z+h+1;break}Z>=32&&(Z-=32,x++,A=b[x]),a=n-k,U?(c>0&&I[d-1]?a+=T:u>0&&I[d-_]?a+=V[d-_]:a+=T,a&=255,V[d]=a,T=a):V[d]=a}t.ptr=t.ptr+4*(x+1)+(Z>0?4:0)}t.pixels.resultPixels=M},decodeBits:function(t,r,i,n,a){var s=r.headerInfo,o=s.fileVersion,l=0,u=new DataView(t,r.ptr,5),c=u.getUint8(0);l++;var d=c>>6,h=0===d?4:3-d,f=(32&c)>0,m=31&c,g=0;if(1===h)g=u.getUint8(l),l++;else if(2===h)g=u.getUint16(l,!0),l+=2;else{if(4!==h)throw"Invalid valid pixel count type";g=u.getUint32(l,!0),l+=4}var _,p,y,v,w,b,x,Z,P,D=2*s.maxZError,k=s.numDims>1?s.maxValues[a]:s.zMax;if(f){r.counter.lut++,Z=u.getUint8(l),m,l++,v=Math.ceil((Z-1)*m/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),r.ptr+=l,y.set(new Uint8Array(t,r.ptr,v)),x=new Uint32Array(p),r.ptr+=v,P=0;while(Z-1>>>P)P++;v=Math.ceil(g*P/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),y.set(new Uint8Array(t,r.ptr,v)),_=new Uint32Array(p),r.ptr+=v,b=o>=3?e.unstuffLUT2(x,m,Z-1,n,D,k):e.unstuffLUT(x,m,Z-1,n,D,k),o>=3?e.unstuff2(_,i,P,g,b):e.unstuff(_,i,P,g,b)}else r.counter.bitstuffer++,P=m,r.ptr+=l,P>0&&(v=Math.ceil(g*P/8),w=Math.ceil(v/4),p=new ArrayBuffer(4*w),y=new Uint8Array(p),y.set(new Uint8Array(t,r.ptr,v)),_=new Uint32Array(p),r.ptr+=v,o>=3?null==n?e.originalUnstuff2(_,i,P,g):e.unstuff2(_,i,P,g,!1,n,D,k):null==n?e.originalUnstuff(_,i,P,g):e.unstuff(_,i,P,g,!1,n,D,k))},readTiles:function(e,r,i){var n=r.headerInfo,a=n.width,s=n.height,o=n.microBlockSize,l=n.imageType,u=t.getDataTypeSize(l),c=Math.ceil(a/o),d=Math.ceil(s/o);r.pixels.numBlocksY=d,r.pixels.numBlocksX=c,r.pixels.ptr=0;var h,f,m,g,_,p,y,v,w,b=0,x=0,Z=0,P=0,D=0,k=0,I=0,T=0,S=0,A=0,U=0,M=0,V=0,B=0,C=0,E=0,R=new i(o*o),F=s%o||o,L=a%o||o,O=n.numDims,N=r.pixels.resultMask,G=r.pixels.resultPixels;for(Z=0;Z<d;Z++)for(D=Z!==d-1?o:F,P=0;P<c;P++)for(k=P!==c-1?o:L,U=Z*a*o+P*o,M=a-k,w=0;w<O;w++){if(O>1&&(G=new i(r.pixels.resultPixels.buffer,a*s*w*u,a*s)),I=e.byteLength-r.ptr,h=new DataView(e,r.ptr,Math.min(10,I)),f={},E=0,T=h.getUint8(0),E++,S=T>>6&255,A=T>>2&15,A!==(P*o>>3&15))throw"integrity issue";if(p=3&T,p>3)throw r.ptr+=E,"Invalid block encoding ("+p+")";if(2!==p)if(0===p){if(r.counter.uncompressed++,r.ptr+=E,V=D*k*u,B=e.byteLength-r.ptr,V=V<B?V:B,m=new ArrayBuffer(V%u===0?V:V+u-V%u),g=new Uint8Array(m),g.set(new Uint8Array(e,r.ptr,V)),_=new i(m),C=0,N)for(b=0;b<D;b++){for(x=0;x<k;x++)N[U]&&(G[U]=_[C++]),U++;U+=M}else for(b=0;b<D;b++){for(x=0;x<k;x++)G[U++]=_[C++];U+=M}r.ptr+=C*u}else if(y=t.getDataTypeUsed(l,S),v=t.getOnePixel(f,E,y,h),E+=t.getDataTypeSize(y),3===p)if(r.ptr+=E,r.counter.constantoffset++,N)for(b=0;b<D;b++){for(x=0;x<k;x++)N[U]&&(G[U]=v),U++;U+=M}else for(b=0;b<D;b++){for(x=0;x<k;x++)G[U++]=v;U+=M}else if(r.ptr+=E,t.decodeBits(e,r,R,v,w),E=0,N)for(b=0;b<D;b++){for(x=0;x<k;x++)N[U]&&(G[U]=R[E++]),U++;U+=M}else for(b=0;b<D;b++){for(x=0;x<k;x++)G[U++]=R[E++];U+=M}else r.counter.constant++,r.ptr+=E}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:t.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t=e.headerInfo.zMax,r=e.headerInfo.numDims,i=e.headerInfo.height*e.headerInfo.width,n=i*r,a=0,s=0,o=0,l=e.pixels.resultMask;if(l)if(r>1)for(a=0;a<r;a++)for(o=a*i,s=0;s<i;s++)l[s]&&(e.pixels.resultPixels[o+s]=t);else for(s=0;s<i;s++)l[s]&&(e.pixels.resultPixels[s]=t);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(t);else for(s=0;s<n;s++)e.pixels.resultPixels[s]=t},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=5e-324&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=0===t?e:1===t?2:1;break;case 7:r=0===t?e:e-2*t+1;break;default:r=e;break}return r},getOnePixel:function(e,t,r,i){var n=0;switch(r){case 0:n=i.getInt8(t);break;case 1:n=i.getUint8(t);break;case 2:n=i.getInt16(t,!0);break;case 3:n=i.getUint16(t,!0);break;case 4:n=i.getInt32(t,!0);break;case 5:n=i.getUInt32(t,!0);break;case 6:n=i.getFloat32(t,!0);break;case 7:n=i.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},r=function(e,t,r){this.val=e,this.left=t,this.right=r},i={decode:function(e,r){r=r||{};var i=r.noDataValue,n=0,a={};if(a.ptr=r.inputOffset||0,a.pixels={},t.readHeaderInfo(e,a)){var s=a.headerInfo,o=s.fileVersion,l=t.getDataTypeArray(s.imageType);t.readMask(e,a),s.numValidPixel===s.width*s.height||a.pixels.resultMask||(a.pixels.resultMask=r.maskData);var u,c=s.width*s.height;if(a.pixels.resultPixels=new l(c*s.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==s.numValidPixel)if(s.zMax===s.zMin)t.constructConstantSurface(a);else if(o>=4&&t.checkMinMaxRanges(e,a))t.constructConstantSurface(a);else{var d=new DataView(e,a.ptr,2),h=d.getUint8(0);if(a.ptr++,h)t.readDataOneSweep(e,a,l);else if(o>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var f=d.getUint8(1);if(a.ptr++,a.encodeMode=f,f>2||o<4&&f>1)throw"Invalid Huffman flag "+f;f?t.readHuffman(e,a,l):t.readTiles(e,a,l)}else t.readTiles(e,a,l)}a.eofOffset=a.ptr,r.inputOffset?(u=a.headerInfo.blobSize+r.inputOffset-a.ptr,Math.abs(u)>=1&&(a.eofOffset=r.inputOffset+a.headerInfo.blobSize)):(u=a.headerInfo.blobSize-a.ptr,Math.abs(u)>=1&&(a.eofOffset=a.headerInfo.blobSize));var m={width:s.width,height:s.height,pixelData:a.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&t.isValidPixelValue(s.imageType,i)){var g=a.pixels.resultMask;for(n=0;n<c;n++)g[n]||(m.pixelData[n]=i);m.noDataValue=i}return a.noDataValue=i,r.returnFileInfo&&(m.fileInfo=t.formatFileInfo(a)),m}},getBandCount:function(e){var r=0,i=0,n={ptr:0,pixels:{}};while(i<e.byteLength-58)t.readHeaderInfo(e,n),i+=n.headerInfo.blobSize,r++,n.ptr=i;return r}};return i}(),s=function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),r=new Uint32Array(e);return r[0]=1,1===t[0]}(),o={decode:function(e,t){if(!s)throw"Big endian system is not supported.";t=t||{};var i,n,o=t.inputOffset||0,l=new Uint8Array(e,o,10),u=String.fromCharCode.apply(null,l);if("CntZImage"===u.trim())i=r,n=1;else{if("Lerc2"!==u.substring(0,5))throw"Unexpected file identifier string: "+u;i=a,n=2}var c,d,h,f,m,g,_=0,p=e.byteLength-10,y=[],v={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]};while(o<p){var w=i.decode(e,{inputOffset:o,encodedMaskData:c,maskData:h,returnMask:0===_,returnEncodedMask:0===_,returnFileInfo:!0,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null});o=w.fileInfo.eofOffset,0===_&&(c=w.encodedMaskData,h=w.maskData,v.width=w.width,v.height=w.height,v.dimCount=w.dimCount||1,v.pixelType=w.pixelType||w.fileInfo.pixelType,v.mask=w.maskData),n>1&&w.fileInfo.mask&&w.fileInfo.mask.numBytes>0&&y.push(w.maskData),_++,v.pixels.push(w.pixelData),v.statistics.push({minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue,dimStats:w.dimStats})}if(n>1&&y.length>1){for(g=v.width*v.height,v.bandMasks=y,h=new Uint8Array(g),h.set(y[0]),f=1;f<y.length;f++)for(d=y[f],m=0;m<g;m++)h[m]=h[m]&d[m];v.maskData=h}return v}};i=[],n=function(){return o}.apply(t,i),void 0===n||(e.exports=n)}()},19853:function(e,t,r){"use strict";r.d(t,{zL:function(){return s}});r(57658);function i(e,t){var r,i=e.length,n=i-t;while(n<--i)r=e[n],e[n++]=e[i],e[i]=r}function n(e){return e}function a(e){if(null==e)return n;var t,r,i=e.scale[0],a=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,n){n||(t=r=0);var l=2,u=e.length,c=new Array(u);c[0]=(t+=e[0])*i+s,c[1]=(r+=e[1])*a+o;while(l<u)c[l]=e[l],++l;return c}}function s(e,t){return"string"===typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return o(e,t)}))}:o(e,t)}function o(e,t){var r=t.id,i=t.bbox,n=null==t.properties?{}:t.properties,a=l(e,t);return null==r&&null==i?{type:"Feature",properties:n,geometry:a}:null==i?{type:"Feature",id:r,properties:n,geometry:a}:{type:"Feature",id:r,bbox:i,properties:n,geometry:a}}function l(e,t){var r=a(e.transform),n=e.arcs;function s(e,t){t.length&&t.pop();for(var a=n[e<0?~e:e],s=0,o=a.length;s<o;++s)t.push(r(a[s],s));e<0&&i(t,o)}function o(e){return r(e)}function l(e){for(var t=[],r=0,i=e.length;r<i;++r)s(e[r],t);return t.length<2&&t.push(t[0]),t}function u(e){var t=l(e);while(t.length<4)t.push(t[0]);return t}function c(e){return e.map(u)}function d(e){var t,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(d)};case"Point":t=o(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(o);break;case"LineString":t=l(e.arcs);break;case"MultiLineString":t=e.arcs.map(l);break;case"Polygon":t=c(e.arcs);break;case"MultiPolygon":t=e.arcs.map(c);break;default:return null}return{type:r,coordinates:t}}return d(t)}r(30541)},94018:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Le}});var i=r(73396);const n={id:"cesiumContainer"};function a(e,t,r,a,s,o){return(0,i.wg)(),(0,i.iD)("div",n)}var s=r(94246),o=r(57554),l=r(40985),u=(r(57658),r(42954)),c=r(71299),d=r(82830),h=r(49721),f=r(51625),m=r(73237),g=r(62385),_=r(54013),p=r(58943),y=r(85914),v=r(32121),w=r(5360),b=r(4275),x=r(4222),Z=r(49350),P=r(23802),D=r(49810),k=r(14982),I=r(92775),T=r(55074),S=r(45262);const A=15;function U(e){this.ellipsoid=(0,h.Z)(e.ellipsoid,g.Z.WGS84),this.credit=void 0,this.tilingScheme=void 0,this.height=void 0,this.width=void 0,this.encoding=void 0,this.lodCount=void 0,this.hasAvailability=!1,this.tilesAvailable=void 0,this.tilesAvailabilityLoaded=void 0,this.levelZeroMaximumGeometricError=void 0,this.terrainDataStructure=void 0}function M(e,t){const r=t.copyrightText;(0,f.Z)(r)&&(e.credit=new d.Z(r));const i=t.spatialReference,n=(0,h.Z)(i.latestWkid,i.wkid),a=t.extent,s={ellipsoid:e.ellipsoid};if(4326===n)s.rectangle=w.Z.fromDegrees(a.xmin,a.ymin,a.xmax,a.ymax),e.tilingScheme=new p.Z(s);else{if(3857!==n)throw new D.Z("Invalid spatial reference");{const r=Math.PI*e.ellipsoid.maximumRadius;t.extent.xmax>r&&(t.extent.xmax=r),t.extent.ymax>r&&(t.extent.ymax=r),t.extent.xmin<-r&&(t.extent.xmin=-r),t.extent.ymin<-r&&(t.extent.ymin=-r),s.rectangleSouthwestInMeters=new u.Z(a.xmin,a.ymin),s.rectangleNortheastInMeters=new u.Z(a.xmax,a.ymax),e.tilingScheme=new S.Z(s)}}const o=t.tileInfo;if(!(0,f.Z)(o))throw new D.Z("tileInfo is required");e.width=o.rows+1,e.height=o.cols+1,e.encoding="LERC"===o.format?y.Z.LERC:y.Z.NONE,e.lodCount=o.lods.length-1;const l=e.hasAvailability=-1!==t.capabilities.indexOf("Tilemap");l&&(e.tilesAvailable=new I.Z(e.tilingScheme,e.lodCount),e.tilesAvailable.addAvailableTileRange(0,0,0,e.tilingScheme.getNumberOfXTilesAtLevel(0),e.tilingScheme.getNumberOfYTilesAtLevel(0)),e.tilesAvailabilityLoaded=new I.Z(e.tilingScheme,e.lodCount)),e.levelZeroMaximumGeometricError=k.Z.getEstimatedLevelZeroGeometricErrorForAHeightmap(e.tilingScheme.ellipsoid,e.width,e.tilingScheme.getNumberOfXTilesAtLevel(0)),t.bandCount>1&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one."),(0,f.Z)(t.minValues)&&(0,f.Z)(t.maxValues)?e.terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:t.minValues[0],highestEncodedHeight:t.maxValues[0]}:e.terrainDataStructure={elementMultiplier:1}}async function V(e,t,r){try{const r=await t.fetchJson();M(e,r)}catch(i){const e=`An error occurred while accessing ${t}.`;throw T.Z.reportError(void 0,r,(0,f.Z)(r)?r._errorEvent:void 0,e),i}}function B(e){e=(0,h.Z)(e,h.Z.EMPTY_OBJECT),this._resource=void 0,this._credit=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._maxLevel=void 0,this._terrainDataStructure=void 0,this._width=void 0,this._height=void 0,this._encoding=void 0,this._lodCount=void 0;const t=e.token;if(this._hasAvailability=!1,this._tilesAvailable=void 0,this._tilesAvailabilityLoaded=void 0,this._availableCache={},this._ready=!1,this._errorEvent=new _.Z,(0,f.Z)(e.url)){(0,m.Z)("ArcGISTiledElevationTerrainProvider options.url","options.url was deprecated in CesiumJS 1.104.  It will be in CesiumJS 1.107.  Use ArcGISTiledElevationTerrainProvider.fromUrl instead.");const r=this,i=new U(e);this._readyPromise=Promise.resolve(e.url).then((async function(e){let n=P.Z.createIfNeeded(e);n.appendForwardSlash(),(0,f.Z)(t)&&(n=n.getDerivedResource({queryParameters:{token:t}})),r._resource=n;const a=n.getDerivedResource({queryParameters:{f:"pjson"}});return await V(i,a,r),i.build(r),!0}))}}function C(e,t,r,i){if(!e._hasAvailability)return;const n=e._tilesAvailabilityLoaded,a=e._tilesAvailable;return!(t>e._lodCount)&&(!!a.isTileAvailable(t,r,i)||!n.isTileAvailable(t,r,i)&&void 0)}function E(e,t,r,i){const n=t-1,a=r-1,s=i[e.y*t+e.x],o=[],l={startX:e.x,startY:e.y,endX:0,endY:0},c=new u.Z(e.x+1,e.y+1);let d=!1,h=!1;while(!d||!h){let r=c.x;const f=h?c.y+1:c.y;if(!d){for(let r=e.y;r<f;++r)if(i[r*t+c.x]!==s){d=!0;break}d?(o.push(new u.Z(c.x,e.y)),--c.x,--r,l.endX=c.x):c.x===n?(l.endX=c.x,d=!0):++c.x}if(!h){const n=c.y*t;for(let t=e.x;t<=r;++t)if(i[n+t]!==s){h=!0;break}h?(o.push(new u.Z(e.x,c.y)),--c.y,l.endY=c.y):c.y===a?(l.endY=c.y,h=!0):++c.y}}return{endingIndices:o,range:l,value:s}}function R(e,t,r,i,n){const a=[],s=n.every((function(e){return e===n[0]}));if(s)return 1===n[0]&&a.push({startX:e,startY:t,endX:e+r-1,endY:t+i-1}),a;let o=[new u.Z(0,0)];while(o.length>0){const s=o.pop(),l=E(s,r,i,n);if(1===l.value){const r=l.range;r.startX+=e,r.endX+=e,r.startY+=t,r.endY+=t,a.push(r)}const u=l.endingIndices;u.length>0&&(o=o.concat(u))}return a}function F(e,t,r,i){if(!e._hasAvailability)return{};const n=128*Math.floor(r/128),a=128*Math.floor(i/128),s=Math.min(1<<t,128),o=`tilemap/${t}/${a}/${n}/${s}/${s}`,l=e._availableCache;if((0,f.Z)(l[o]))return l[o];const u=new b.Z({throttle:!1,throttleByServer:!0,type:Z.Z.TERRAIN}),c=e._resource.getDerivedResource({url:o,request:u});let d=c.fetchJson();return(0,f.Z)(d)?(d=d.then((function(o){const l=R(n,a,s,s,o.data);e._tilesAvailabilityLoaded.addAvailableTileRange(t,n,a,n+s,a+s);const u=e._tilesAvailable;for(let e=0;e<l.length;++e){const r=l[e];u.addAvailableTileRange(t,r.startX,r.startY,r.endX,r.endY)}return C(e,t,r,i)})),l[o]={promise:d,request:u},d=d.finally((function(e){return delete l[o],e})),{promise:d,request:u}):{}}U.prototype.build=function(e){e._credit=this.credit,e._tilingScheme=this.tilingScheme,e._height=this.height,e._width=this.width,e._encoding=this.encoding,e._lodCount=this.lodCount,e._hasAvailability=this.hasAvailability,e._tilesAvailable=this.tilesAvailable,e._tilesAvailabilityLoaded=this.tilesAvailabilityLoaded,e._levelZeroMaximumGeometricError=this.levelZeroMaximumGeometricError,e._terrainDataStructure=this.terrainDataStructure,e._ready=!0},Object.defineProperties(B.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return(0,m.Z)("ArcGISTiledElevationTerrainProvider.ready","ArcGISTiledElevationTerrainProvider.ready was deprecated in CesiumJS 1.104.  It will be in CesiumJS 1.107.  Use ArcGISTiledElevationTerrainProvider.fromUrl instead."),this._ready}},readyPromise:{get:function(){return(0,m.Z)("ArcGISTiledElevationTerrainProvider.readyPromise","ArcGISTiledElevationTerrainProvider.readyPromise was deprecated in CesiumJS 1.104.  It will be in CesiumJS 1.107.  Use ArcGISTiledElevationTerrainProvider.fromUrl instead."),this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){return this._tilesAvailable}}}),B.fromUrl=async function(e,t){c.Z.defined("url",e),t=(0,h.Z)(t,h.Z.EMPTY_OBJECT),e=await Promise.resolve(e);let r=P.Z.createIfNeeded(e);r.appendForwardSlash(),(0,f.Z)(t.token)&&(r=r.getDerivedResource({queryParameters:{token:t.token}}));const i=r.getDerivedResource({queryParameters:{f:"pjson"}}),n=new U(t);await V(n,i);const a=new B(t);return n.build(a),a._resource=r,a},B.prototype.requestTileGeometry=function(e,t,r,i){const n=this._resource.getDerivedResource({url:`tile/${r}/${t}/${e}`,request:i}),a=this._hasAvailability;let s,o=Promise.resolve(!0);if(a&&!(0,f.Z)(C(this,r+1,2*e,2*t))){const i=F(this,r+1,2*e,2*t);o=i.promise,s=i.request}const l=n.fetchArrayBuffer();if(!(0,f.Z)(l)||!(0,f.Z)(o))return;const u=this,c=this._tilesAvailable;return Promise.all([l,o]).then((function(i){return new v.Z({buffer:i[0],width:u._width,height:u._height,childTileMask:a?c.computeChildMaskForTile(r,e,t):A,structure:u._terrainDataStructure,encoding:u._encoding})})).catch((function(e){return(0,f.Z)(s)&&s.state===x.Z.CANCELLED?(i.cancel(),i.deferred.promise.finally((function(){return i.state=x.Z.CANCELLED,Promise.reject(e)}))):Promise.reject(e)}))},B.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},B.prototype.getTileDataAvailable=function(e,t,r){if(!this._hasAvailability)return;const i=C(this,r,e,t);if((0,f.Z)(i))return i;F(this,r,e,t)},B.prototype.loadTileDataAvailability=function(e,t,r){};var L=B,O=(r(63408),r(14590),r(30172)),N=r(88002),G=r(45402),z=r(13968),j=r(24406),q=r(92067),X=r(70805),Y=r(547),$=r(121),J=r(87389),H=r(67584),W=r(51853);function Q(e,t){this._parent=e,this._dataProvider=e._dataProvider,this._layer=e._layer,(0,f.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${t}`}):this._resource=this._parent.resource.getDerivedResource({url:t})}Object.defineProperties(Q.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}}}),Q.prototype.load=async function(){return this._data=await Ce.loadJson(this._resource,this._dataProvider._traceFetches),this._data};var K=Q;function ee(e,t){this._storageInfo=t,this._parent=e,this._dataProvider=e._dataProvider;const r=`attributes/${t.key}/0`;(0,f.Z)(this._parent._nodeIndex)?this._resource=this._parent._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.attribute.resource}/${r}`}):this._resource=this._parent.resource.getDerivedResource({url:r})}function te(e){return"UInt8"===e||"Int8"===e?1:"UInt16"===e||"Int16"===e?2:"UInt32"===e||"Int32"===e||"Oid32"===e||"Float32"===e?4:"UInt64"===e||"Int64"===e||"Float64"===e?8:0}Object.defineProperties(ee.prototype,{resource:{get:function(){return this._resource}},header:{get:function(){return this._header}},values:{get:function(){return(0,f.Z)(this._values)&&(0,f.Z)(this._values.attributeValues)?this._values.attributeValues:[]}},name:{get:function(){return this._storageInfo.name}}}),ee.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){const r=new DataView(t);let i=!0;if(r.getUint8(0)==="{".charCodeAt(0)){const r=new TextDecoder,n=r.decode(t);n.includes("404")&&(i=!1,console.error(`Failed to load: ${e.resource.url}`))}if(i){e._data=t;let i=e._parseHeader(r);const n=te(e._storageInfo.attributeValues.valueType);n>0&&(i=Math.ceil(i/n)*n),e._parseBody(r,i)}}))},ee.prototype._parseValue=function(e,t,r){let i;if("UInt8"===t)i=e.getUint8(r),r+=1;else if("Int8"===t)i=e.getInt8(r),r+=1;else if("UInt16"===t)i=e.getUint16(r,!0),r+=2;else if("Int16"===t)i=e.getInt16(r,!0),r+=2;else if("UInt32"===t)i=e.getUint32(r,!0),r+=4;else if("Oid32"===t)i=e.getUint32(r,!0),r+=4;else if("Int32"===t)i=e.getInt32(r,!0),r+=4;else if("UInt64"===t){const t=e.getUint32(r,!0),n=e.getUint32(r+4,!0);i=t+Math.pow(2,32)*n,r+=8}else if("Int64"===t){const t=e.getUint32(r,!0),n=e.getUint32(r+4,!0);i=n<Math.pow(2,31)?t+Math.pow(2,32)*n:t+Math.pow(2,32)*(n-Math.pow(2,32)),r+=8}else"Float32"===t?(i=e.getFloat32(r,!0),r+=4):"Float64"===t?(i=e.getFloat64(r,!0),r+=8):"String"===t&&(i=String.fromCharCode(e.getUint8(r)),r+=1);return{value:i,offset:r}},ee.prototype._parseHeader=function(e){let t=0;this._header={};for(let r=0;r<this._storageInfo.header.length;r++){const i=this._storageInfo.header[r],n=this._parseValue(e,i.valueType,t);this._header[i.property]=n.value,t=n.offset}return t},ee.prototype._parseBody=function(e,t){this._values={};for(let r=0;r<this._storageInfo.ordering.length;r++){const i=this._storageInfo.ordering[r],n=this._storageInfo[i];if((0,f.Z)(n)){this._values[i]=[];for(let r=0;r<this._header.count;++r)if("String"!==n.valueType){const r=this._parseValue(e,n.valueType,t);this._values[i].push(r.value),t=r.offset}else{const a=this._values.attributeByteCounts[r];let s="";for(let r=0;r<a;++r){const r=this._parseValue(e,n.valueType,t);0!==r.value.charCodeAt(0)&&(s+=r.value),t=r.offset}this._values[i].push(s)}}}};var re=ee,ie=r(40617);function ne(e,t){const r=e._dataProvider,i=e._layer;let n;n=(0,f.Z)(e._nodeIndex)?i.resource.getDerivedResource({url:`nodes/${e._data.mesh.geometry.resource}/${t}`}):e.resource.getDerivedResource({url:t}),this._parent=e,this._dataProvider=r,this._layer=i,this._resource=n,this._customAttributes=void 0}Object.defineProperties(ne.prototype,{resource:{get:function(){return this._resource}},data:{get:function(){return this._data}},customAttributes:{get:function(){return this._customAttributes}}}),ne.prototype.load=function(){const e=this;return this._dataProvider._loadBinary(this._resource).then((function(t){return e._data=t,t}))};const ae=new ie.Z,se=new ie.Z,oe=new ie.Z,le=new ie.Z,ue=new ie.Z;function ce(e,t,r,i){const n=ie.Z.subtract(i,r,ae),a=ie.Z.cross(n,ie.Z.subtract(e,r,se),le),s=ie.Z.cross(n,ie.Z.subtract(t,r,oe),ue);return ie.Z.dot(a,s)>=0}const de=new ie.Z,he=new ie.Z,fe=new ie.Z,me=new ie.Z,ge=new ie.Z,_e=new ie.Z,pe=new ie.Z,ye=new ie.Z,ve=new ie.Z,we=new ie.Z;ne.prototype.getClosestPointIndexOnTriangle=function(e,t,r){if((0,f.Z)(this._customAttributes)&&(0,f.Z)(this._customAttributes.positions)){const i=new ie.Z(e,t,r);i.x-=this._customAttributes.cartesianCenter.x,i.y-=this._customAttributes.cartesianCenter.y,i.z-=this._customAttributes.cartesianCenter.z,Y.Z.multiplyByVector(this._customAttributes.parentRotation,i,i);let n,a,s,o,l=Number.MAX_VALUE;const u=this._customAttributes.positions,c=this._customAttributes.indices;let d;d=(0,f.Z)(c)?c.length:u.length/3;for(let e=0;e<d;e++){let t,r,d;(0,f.Z)(c)?(t=c[e],r=c[e+1],d=c[e+2]):(t=3*e,r=3*e+1,d=3*e+2);const h=ie.Z.fromElements(u[3*t],u[3*t+1],u[3*t+2],de),m=ie.Z.fromElements(u[3*r],u[3*r+1],u[3*r+2],he),g=new ie.Z(u[3*d],u[3*d+1],u[3*d+2],fe);if(!ce(i,h,m,g)||!ce(i,m,h,g)||!ce(i,g,h,m))continue;const _=ie.Z.subtract(m,h,me),p=ie.Z.subtract(g,h,ge),y=ie.Z.cross(_,p,_e);if(0===ie.Z.magnitude(y))continue;const v=ie.Z.normalize(y,pe),w=ie.Z.subtract(i,h,ye),b=Math.abs(ie.Z.dot(w,v));if(b<l){l=b,n=e;const u=ie.Z.magnitudeSquared(ie.Z.subtract(i,h,w)),c=ie.Z.magnitudeSquared(ie.Z.subtract(i,m,ve)),f=ie.Z.magnitudeSquared(ie.Z.subtract(i,g,we));u<c&&u<f?(s=t,o=h,a=u):c<f?(s=r,o=m,a=c):(s=d,o=g,a=f)}}if((0,f.Z)(n))return{index:s,distanceSquared:a,distance:Math.sqrt(a),queriedPosition:i,closestPosition:ie.Z.clone(o)}}return{index:-1,distanceSquared:Number.Infinity,distance:Number.Infinity}},ne.prototype._generateGltf=function(e,t,r,i,n,a){let s,o={pbrMetallicRoughness:{metallicFactor:0},doubleSided:!0,name:"Material"},l=!1,u="";if((0,f.Z)(this._parent._data.mesh)&&(0,f.Z)(this._layer._data.materialDefinitions)){const e=this._parent._data.mesh.material,t=e.definition;if(t>=0&&t<this._layer._data.materialDefinitions.length&&(s=this._layer._data.materialDefinitions[t],o=s,(0,f.Z)(o.pbrMetallicRoughness)&&(0,f.Z)(o.pbrMetallicRoughness.baseColorTexture))){l=!0,o.pbrMetallicRoughness.baseColorTexture.index=0;let e="0";if((0,f.Z)(this._layer._data.textureSetDefinitions))for(let t=0;t<this._layer._data.textureSetDefinitions.length;t++){const r=this._layer._data.textureSetDefinitions[t];for(let t=0;t<r.formats.length;t++){const i=r.formats[t];if("jpg"===i.format){e=i.name;break}}}(0,f.Z)(this._parent._data.mesh)&&this._parent._data.mesh.material.resource>=0&&(u=this._layer.resource.getDerivedResource({url:`nodes/${this._parent._data.mesh.material.resource}/textures/${e}`}).url)}}else(0,f.Z)(this._parent._data.textureData)&&(l=!0,u=this._parent.resource.getDerivedResource({url:`${this._parent._data.textureData[0].href}`}).url,o.pbrMetallicRoughness.baseColorTexture={index:0});let c=[],d=[],h=[];l&&(c=[{sampler:0,source:0}],d=[{uri:u}],h=[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}]);const m={scene:0,scenes:[{nodes:e}],nodes:t,meshes:r,buffers:i,bufferViews:n,accessors:a,materials:[o],textures:c,images:d,samplers:h,asset:{version:"2.0"}};return m};var be=ne;function xe(e,t,r){let i,n,a,s;r?(i=0,n=e):(i=e._level+1,n=e._layer),"number"===typeof t?a=t:s=e.resource.getDerivedResource({url:`${t}/`}),this._parent=e,this._dataProvider=e._dataProvider,this._isRoot=r,this._level=i,this._layer=n,this._nodeIndex=a,this._resource=s,this._isLoading=!1,this._tile=void 0,this._data=void 0,this._geometryData=[],this._featureData=[],this._fields={},this._children=[],this._childrenReadyPromise=void 0,this._globalTransform=void 0,this._inverseGlobalTransform=void 0,this._inverseRotationMatrix=void 0}function Ze(e,t,r,i,n,a){const s=r*(1-e)+i*e,o=n*(1-e)+a*e;return s*(1-t)+o*t}function Pe(e,t,r,i){const n=e+t*r;return i[n]}function De(e,t,r){const i=r.nativeExtent;let n=(e-i.west)/(i.east-i.west)*(r.width-1),a=(t-i.south)/(i.north-i.south)*(r.height-1);const s=Math.floor(n);let o=Math.floor(a);n-=s,a-=o;const l=s<r.width?s+1:s;let u=o<r.height?o+1:o;o=r.height-1-o,u=r.height-1-u;const c=Pe(s,o,r.width,r.buffer),d=Pe(l,o,r.width,r.buffer),h=Pe(s,u,r.width,r.buffer),f=Pe(l,u,r.width,r.buffer);let m=Ze(n,a,c,d,h,f);return m=m*r.scale+r.offset,m}Object.defineProperties(xe.prototype,{resource:{get:function(){return this._resource}},layer:{get:function(){return this._layer}},parent:{get:function(){return this._parent}},children:{get:function(){return this._children}},geometryData:{get:function(){return this._geometryData}},featureData:{get:function(){return this._featureData}},fields:{get:function(){return this._fields}},tile:{get:function(){return this._tile}},data:{get:function(){return this._data}}}),xe.prototype.load=async function(){const e=this;function t(){if(!e._isRoot){const t=e._create3DTileDefinition();e._tile=new W.Z(e._layer._tileset,e._dataProvider.resource,t,e._parent._tile),e._tile._i3sNode=e}}if(!(0,f.Z)(this._nodeIndex)){const r=await Ce.loadJson(this._resource,this._dataProvider._traceFetches);return e._data=r,void t()}const r=await this._layer._getNodeInNodePages(this._nodeIndex);let i;if(e._data=r,e._isRoot)i="nodes/root/";else if((0,f.Z)(r.mesh)){const e=r.mesh.geometry.resource;i=`../${e}/`}(0,f.Z)(i)&&(e._resource=e._parent.resource.getDerivedResource({url:i})),t()},xe.prototype.loadFields=function(){const e=this._layer._data.attributeStorageInfo,t=this;function r(e,r){const i=new re(t,e[r]);return t._fields[i._storageInfo.name]=i,i.load()}const i=[];if((0,f.Z)(e))for(let n=0;n<e.length;n++)i.push(r(e,n));return Promise.all(i)},xe.prototype.getFieldsForPickedPosition=function(e){const t=this.geometryData[0];if(!(0,f.Z)(t.customAttributes.featureIndex))return{};const r=t.getClosestPointIndexOnTriangle(e.x,e.y,e.z);if(-1===r.index||r.index>t.customAttributes.featureIndex.length)return{};const i=t.customAttributes.featureIndex[r.index];return this.getFieldsForFeature(i)},xe.prototype.getFieldsForFeature=function(e){const t={};for(const r in this.fields)if(this.fields.hasOwnProperty(r)){const i=this.fields[r];e>=0&&e<i.values.length&&(t[i.name]=i.values[e])}return t},xe.prototype._loadChildren=function(){const e=this;if((0,f.Z)(this._childrenReadyPromise))return this._childrenReadyPromise;const t=[];if((0,f.Z)(e._data.children))for(let r=0;r<e._data.children.length;r++){const i=e._data.children[r],n=new xe(e,(0,h.Z)(i.href,i),!1);e._children.push(n),t.push(n.load())}return this._childrenReadyPromise=Promise.all(t).then((function(){for(let t=0;t<e._children.length;t++)e._tile.children.push(e._children[t]._tile)})),this._childrenReadyPromise},xe.prototype._loadGeometryData=function(){const e=[];if((0,f.Z)(this._data.geometryData))for(let t=0;t<this._data.geometryData.length;t++){const r=new be(this,this._data.geometryData[t].href);this._geometryData.push(r),e.push(r.load())}else if((0,f.Z)(this._data.mesh)){const t=this._layer._findBestGeometryBuffers(this._data.mesh.geometry.definition,["position","uv0"]),r=`./geometries/${t.bufferIndex}/`,i=new be(this,r);i._geometryDefinitions=t.definition,i._geometryBufferInfo=t.geometryBufferInfo,this._geometryData.push(i),e.push(i.load())}return Promise.all(e)},xe.prototype._loadFeatureData=function(){const e=[];if((0,f.Z)(this._data.featureData))for(let t=0;t<this._data.featureData.length;t++){const r=new K(this,this._data.featureData[t].href);this._featureData.push(r),e.push(r.load())}return Promise.all(e)},xe.prototype._clearGeometryData=function(){this._geometryData=[]},xe.prototype._create3DTileDefinition=function(){const e=this._data.obb,t=this._data.mbs;if(!(0,f.Z)(e)&&!(0,f.Z)(t))return void console.error("Failed to load I3S node. Bounding volume is required.");let r;if(r=(0,f.Z)(e)?O.Z.fromDegrees(e.center[0],e.center[1],e.center[2]):O.Z.fromDegrees(t[0],t[1],t[2]),(0,f.Z)(this._dataProvider._geoidDataList)&&(0,f.Z)(r))for(let f=0;f<this._dataProvider._geoidDataList.length;f++){const e=this._dataProvider._geoidDataList[f],t=e.projection.project(r);if(t.x>e.nativeExtent.west&&t.x<e.nativeExtent.east&&t.y>e.nativeExtent.south&&t.y<e.nativeExtent.north){r.height+=De(t.x,t.y,e);break}}let i,n={},a=0;(0,f.Z)(e)?(n={box:[0,0,0,e.halfSize[0],0,0,0,e.halfSize[1],0,0,0,e.halfSize[2]]},a=Math.max(Math.max(this._data.obb.halfSize[0],this._data.obb.halfSize[1]),this._data.obb.halfSize[2]),i=g.Z.WGS84.cartographicToCartesian(r)):(n={sphere:[0,0,0,t[3]]},i=g.Z.WGS84.cartographicToCartesian(r),a=this._data.mbs[3]),a*=2;let s=1/0;if((0,f.Z)(this._data.lodThreshold))if("maxScreenThresholdSQ"===this._layer._data.nodePages.lodSelectionMetricType){const e=Math.sqrt(this._data.lodThreshold/(.25*Math.PI));s=a/e}else if("maxScreenThreshold"===this._layer._data.nodePages.lodSelectionMetricType){const e=this._data.lodThreshold;s=a/e}else console.error("Invalid lodSelectionMetricType in Layer");else if((0,f.Z)(this._data.lodSelection))for(let f=0;f<this._data.lodSelection.length;f++)"maxScreenThreshold"===this._data.lodSelection[f].metricType&&(s=a/this._data.lodSelection[f].maxError);s===1/0&&(s=1e5);const o=16*s,l=new q.Z(0,0,0);let u=H.Z.headingPitchRollQuaternion(i,l);(0,f.Z)(this._data.obb)&&(u=new J.Z(this._data.obb.quaternion[0],this._data.obb.quaternion[1],this._data.obb.quaternion[2],this._data.obb.quaternion[3]));const c=Y.Z.fromQuaternion(u),d=Y.Z.inverse(c,new Y.Z),h=new $.Z(c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,i.x,i.y,i.z,1),m=$.Z.inverse(h,new $.Z),_=$.Z.clone(h);(0,f.Z)(this._parent._globalTransform)&&$.Z.multiply(h,this._parent._inverseGlobalTransform,_),this._globalTransform=h,this._inverseGlobalTransform=m,this._inverseRotationMatrix=d;const p=[];for(let f=0;f<this._children.length;f++)p.push(this._children[f]._create3DTileDefinition());const y={children:p,refine:"REPLACE",boundingVolume:n,transform:[_[0],_[4],_[8],_[12],_[1],_[5],_[9],_[13],_[2],_[6],_[10],_[14],_[3],_[7],_[11],_[15]],content:{uri:(0,f.Z)(this._resource)?this._resource.url:void 0},geometricError:o};return y},xe.prototype._createI3SDecoderTask=async function(e,t){const r=t.geometryData._parent._data,i=t.geometryData._parent._inverseRotationMatrix;let n=0,a=0,s=0;(0,f.Z)(r.obb)?(n=r.obb.center[0],a=r.obb.center[1],s=r.obb.center[2]):(0,f.Z)(r.mbs)&&(n=r.mbs[0],a=r.mbs[1],s=r.mbs[2]);const o=Y.Z.fromRotationX(-X.Z.PI_OVER_TWO),l=new Y.Z;Y.Z.multiply(o,i,l);const u=O.Z.fromDegrees(n,a,s),c=g.Z.WGS84.cartographicToCartesian(u),d={binaryData:t.geometryData._data,featureData:(0,f.Z)(t.featureData)&&(0,f.Z)(t.featureData[0])?t.featureData[0].data:void 0,schema:t.defaultGeometrySchema,bufferInfo:t.geometryData._geometryBufferInfo,ellipsoidRadiiSquare:g.Z.WGS84.radiiSquared,url:t.url,geoidDataList:t.geometryData._dataProvider._geoidDataList,cartographicCenter:u,cartesianCenter:c,parentRotation:l},h=[];return e.scheduleTask(d,h)},xe.prototype._createContentURL=async function(){let e={scene:0,scenes:[{nodes:[0]}],nodes:[{name:"singleNode"}],meshes:[],buffers:[],bufferViews:[],accessors:[],materials:[],textures:[],images:[],samplers:[],asset:{version:"2.0"}};const t=await this._dataProvider.getDecoderTaskProcessor(),r=[this._loadGeometryData()];this._dataProvider.legacyVersion16&&r.push(this._loadFeatureData());const i=this;return Promise.all(r).then((function(){let r=Promise.resolve();if((0,f.Z)(i._geometryData)&&i._geometryData.length>0){const n={geometryData:i._geometryData[0],featureData:i._featureData,defaultGeometrySchema:i._layer._data.store.defaultGeometrySchema,url:i._geometryData[0].resource.url,tile:i._tile},a=i._createI3SDecoderTask(t,n);if(!(0,f.Z)(a))return;r=a.then((function(t){e=n.geometryData._generateGltf(t.meshData.nodesInScene,t.meshData.nodes,t.meshData.meshes,t.meshData.buffers,t.meshData.bufferViews,t.meshData.accessors),i._geometryData[0]._customAttributes=t.meshData._customAttributes}))}return r.then((function(){const t=i._dataProvider._binarizeGltf(e),r=new Blob([t],{type:"application/binary"});return URL.createObjectURL(r)}))}))},W.Z.prototype._hookedRequestContent=W.Z.prototype.requestContent,W.Z.prototype.requestContent=function(){return this.tileset._isI3STileSet?this._isLoading?void 0:(this._isLoading=!0,this._i3sNode._createContentURL().then((e=>{if((0,f.Z)(e))return this._contentResource=new P.Z({url:e}),this._hookedRequestContent();this._isLoading=!1})).then((e=>(this._isLoading=!1,e)))):this._hookedRequestContent()},Object.defineProperties(W.Z.prototype,{i3sNode:{get:function(){return this._i3sNode}}});var ke=xe;function Ie(e,t,r){this._dataProvider=e,(0,f.Z)(t.href)||(t.href=`./layers/${r}`);const i=this._dataProvider.resource.getUrlComponent();let n="";n=i.match(/layers\/\d/)?`${i}`.replace(/\/+$/,""):`${i}`.replace(/\/?$/,"/").concat(`${t.href}`),this._version=t.store.version;const a=this._version.split(".");this._majorVersion=parseInt(a[0]),this._minorVersion=a.length>1?parseInt(a[1]):0,this._resource=new P.Z({url:n}),this._resource.setQueryParameters(this._dataProvider.resource.queryParameters),this._resource.appendForwardSlash(),this._data=t,this._rootNode=void 0,this._nodePages={},this._nodePageFetches={},this._extent=void 0,this._tileset=void 0,this._geometryDefinitions=void 0,this._computeGeometryDefinitions(!0),this._computeExtent()}Object.defineProperties(Ie.prototype,{resource:{get:function(){return this._resource}},rootNode:{get:function(){return this._rootNode}},tileset:{get:function(){return this._tileset}},data:{get:function(){return this._data}},version:{get:function(){return this._version}},majorVersion:{get:function(){return this._majorVersion}},minorVersion:{get:function(){return this._minorVersion}},legacyVersion16:{get:function(){if((0,f.Z)(this.version))return this.majorVersion<1||1===this.majorVersion&&this.minorVersion<=6}}}),Ie.prototype.load=async function(){if(4326!==this._data.spatialReference.wkid)throw new D.Z(`Unsupported spatial reference: ${this._data.spatialReference.wkid}`);if(await this._dataProvider.loadGeoidData(),await this._loadRootNode(),await this._create3DTileset(),this._rootNode._tile=this._tileset._root,this._tileset._root._i3sNode=this._rootNode,this.legacyVersion16)return this._rootNode._loadChildren()},Ie.prototype._computeGeometryDefinitions=function(e){if(this._geometryDefinitions=[],(0,f.Z)(this._data.geometryDefinitions))for(let t=0;t<this._data.geometryDefinitions.length;t++){const r=[],i=this._data.geometryDefinitions[t].geometryBuffers;for(let t=0;t<i.length;t++){const n=i[t],a=[];let s=!1;if((0,f.Z)(n.compressedAttributes)&&e){s=!0;const e=n.compressedAttributes.attributes;for(let t=0;t<e.length;t++)a.push(e[t])}else for(const e in n)"offset"!==e&&a.push(e);r.push({compressed:s,attributes:a,index:i.indexOf(n)})}r.sort((function(e,t){return e.compressed&&!t.compressed?-1:!e.compressed&&t.compressed?1:e.attributes.length-t.attributes.length})),this._geometryDefinitions.push(r)}},Ie.prototype._findBestGeometryBuffers=function(e,t){const r=this._geometryDefinitions[e];if((0,f.Z)(r))for(let i=0;i<r.length;++i){const e=r[i];let n=!1;const a=e.attributes;for(let r=0;r<t.length;r++)if(!a.includes(t[r])){n=!0;break}if(!n)return{bufferIndex:e.index,definition:r,geometryBufferInfo:e}}return 0},Ie.prototype._loadRootNode=function(){if((0,f.Z)(this._data.nodePages)){let e=0;(0,f.Z)(this._data.nodePages.rootIndex)&&(e=this._data.nodePages.rootIndex),this._rootNode=new ke(this,e,!0)}else this._rootNode=new ke(this,this._data.store.rootNode,!0);return this._rootNode.load()},Ie.prototype._getNodeInNodePages=function(e){const t=Math.floor(e/this._data.nodePages.nodesPerPage),r=e%this._data.nodePages.nodesPerPage,i=this;return this._loadNodePage(t).then((function(){return i._nodePages[t][r]}))},Ie._fetchJson=function(e){return e.fetchJson()},Ie.prototype._loadNodePage=function(e){const t=this;if(!(0,f.Z)(this._nodePageFetches[e])){const r=this.resource.getDerivedResource({url:`nodepages/${e}/`}),i=Ie._fetchJson(r).then((function(r){return(0,f.Z)(r.error)&&200!==r.error.code?Promise.reject(r.error):(t._nodePages[e]=r.nodes,r)}));this._nodePageFetches[e]=i}return this._nodePageFetches[e]},Ie.prototype._computeExtent=function(){(0,f.Z)(this._data.fullExtent)?this._extent=w.Z.fromDegrees(this._data.fullExtent.xmin,this._data.fullExtent.ymin,this._data.fullExtent.xmax,this._data.fullExtent.ymax):(0,f.Z)(this._data.store.extent)&&(this._extent=w.Z.fromDegrees(this._data.store.extent[0],this._data.store.extent[1],this._data.store.extent[2],this._data.store.extent[3]))},Ie.prototype._create3DTileset=async function(){const e={asset:{version:"1.0"},geometricError:Number.MAX_VALUE,root:this._rootNode._create3DTileDefinition()},t=new Blob([JSON.stringify(e)],{type:"application/json"}),r=URL.createObjectURL(t),i={};if((0,f.Z)(this._dataProvider._cesium3dTilesetOptions))for(const n in this._dataProvider._cesium3dTilesetOptions)this._dataProvider._cesium3dTilesetOptions.hasOwnProperty(n)&&(i[n]=this._dataProvider._cesium3dTilesetOptions[n]);this._tileset=await j.Z.fromUrl(r,i),this._tileset.show=this._dataProvider.show,this._tileset._isI3STileSet=!0,this._tileset.tileUnload.addEventListener((function(e){e._i3sNode._clearGeometryData(),URL.revokeObjectURL(e._contentResource._url),e._contentResource=e._i3sNode.resource})),this._tileset.tileVisible.addEventListener((function(e){(0,f.Z)(e._i3sNode)&&e._i3sNode._loadChildren()}))};var Te=Ie,Se=r(7944);function Ae(e){e=(0,h.Z)(e,h.Z.EMPTY_OBJECT),this._name=e.name,this._show=(0,h.Z)(e.show,!0),this._geoidTiledTerrainProvider=e.geoidTiledTerrainProvider,this._traceFetches=(0,h.Z)(e.traceFetches,!1),this._cesium3dTilesetOptions=(0,h.Z)(e.cesium3dTilesetOptions,h.Z.EMPTY_OBJECT),this._layers=[],this._data=void 0,this._extent=void 0,this._geoidDataPromise=void 0,this._geoidDataList=void 0,this._decoderTaskProcessor=void 0,this._taskProcessorReadyPromise=void 0,(0,f.Z)(e.url)&&((0,m.Z)("I3SDataProvider options.url","I3SDataProvider constructor parameter options.url was deprecated in CesiumJS 1.104. It will be removed in 1.107. Use I3SDataProvider.fromUrl instead."),this._readyPromise=void 0,this._ready=!1,this._resource=P.Z.createIfNeeded(e.url),this._load())}function Ue(e,t){return Ve(e,t)}Object.defineProperties(Ae.prototype,{name:{get:function(){return this._name}},show:{get:function(){return this._show},set:function(e){c.Z.defined("value",e),this._show=e;for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&(this._layers[t]._tileset.show=this._show)}},traceFetches:{get:function(){return this._traceFetches},set:function(e){c.Z.defined("value",e),this._traceFetches=e}},geoidTiledTerrainProvider:{get:function(){return this._geoidTiledTerrainProvider}},layers:{get:function(){return this._layers}},data:{get:function(){return this._data}},extent:{get:function(){return this._extent}},readyPromise:{get:function(){return(0,m.Z)("I3SDataProvider.readyPromise","I3SDataProvider.readyPromise was deprecated in CesiumJS 1.104. It will be removed in 1.107. Use I3SDataProvider.fromUrl instead."),this._readyPromise}},ready:{get:function(){return(0,m.Z)("I3SDataProvider.ready","I3SDataProvider.ready was deprecated in CesiumJS 1.104. It will be removed in 1.107. Use I3SDataProvider.fromUrl instead."),this._ready}},resource:{get:function(){return this._resource}}}),Ae.prototype.destroy=function(){for(let e=0;e<this._layers.length;e++)(0,f.Z)(this._layers[e]._tileset)&&this._layers[e]._tileset.destroy();return(0,N.Z)(this)},Ae.prototype.isDestroyed=function(){return!1},Ae.prototype.update=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.update(e)},Ae.prototype.prePassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.prePassesUpdate(e)},Ae.prototype.postPassesUpdate=function(e){for(let t=0;t<this._layers.length;t++)(0,f.Z)(this._layers[t]._tileset)&&this._layers[t]._tileset.postPassesUpdate(e)},Ae.prototype.updateForPass=function(e,t){for(let r=0;r<this._layers.length;r++)(0,f.Z)(this._layers[r]._tileset)&&this._layers[r]._tileset.updateForPass(e,t)},Ae.fromUrl=async function(e,t){c.Z.defined("url",e),t=(0,h.Z)(t,h.Z.EMPTY_OBJECT);const r=P.Z.createIfNeeded(e),i=await Ae.loadJson(r),n=new Ae(t);if(n._resource=r,n._data=i,(0,f.Z)(i.layers))for(let s=0;s<i.layers.length;s++){const e=new Te(n,i.layers[s],s);n._layers.push(e)}else{const e=new Te(n,i,i.id);n._layers.push(e)}n._computeExtent();const a=[];for(let s=0;s<n._layers.length;s++)a.push(n._layers[s].load());return await Promise.all(a),n._ready=!0,n._readyPromise=Promise.resolve(n),n},Ae.prototype._load=function(){const e=this;return this._readyPromise=Ae.loadJson(this._resource,this._traceFetches).then((function(t){if(e._data=t,(0,f.Z)(t.layers))for(let i=0;i<t.layers.length;i++){const r=new Te(e,t.layers[i],i);e._layers.push(r)}else{const r=new Te(e,t,t.id);e._layers.push(r)}e._computeExtent();const r=[];for(let i=0;i<e._layers.length;i++)r.push(e._layers[i].load());return Promise.all(r).then((function(){return e._ready=!0,e}))})),this._readyPromise},Ae._fetchJson=function(e){return e.fetchJson()},Ae.loadJson=async function(e,t){t&&console.log("I3S FETCH:",e.url);const r=await Ae._fetchJson(e);if((0,f.Z)(r.error)){if(console.error("Failed to fetch I3S ",e.url),(0,f.Z)(r.error.message)&&console.error(r.error.message),(0,f.Z)(r.error.details))for(let e=0;e<r.error.details.length;e++)console.log(r.error.details[e]);throw new D.Z(r.error)}return r},Ae.prototype._loadBinary=function(e){return this._traceFetches&&console.log("I3S FETCH:",e.url),e.fetchArrayBuffer()},Ae.prototype._binarizeGltf=function(e){const t=new TextEncoder,r=t.encode(JSON.stringify(e)),i=new Uint8Array(r.byteLength+20),n={magic:new Uint8Array(i.buffer,0,4),version:new Uint32Array(i.buffer,4,1),length:new Uint32Array(i.buffer,8,1),chunkLength:new Uint32Array(i.buffer,12,1),chunkType:new Uint32Array(i.buffer,16,1),chunkData:new Uint8Array(i.buffer,20,r.byteLength)};return n.magic[0]="g".charCodeAt(),n.magic[1]="l".charCodeAt(),n.magic[2]="T".charCodeAt(),n.magic[3]="F".charCodeAt(),n.version[0]=2,n.length[0]=i.byteLength,n.chunkLength[0]=r.byteLength,n.chunkType[0]=1313821514,n.chunkData.set(r),i},Ae.prototype.getDecoderTaskProcessor=function(){if((0,f.Z)(this._taskProcessorReadyPromise))return this._taskProcessorReadyPromise;if(!(0,f.Z)(this._decoderTaskProcessor)){const e=new G.Z("decodeI3S");this._taskProcessorReadyPromise=e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_decoder_nodejs.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}).then((()=>e)),this._decoderTaskProcessor=e}return this._taskProcessorReadyPromise};const Me=new u.Z;function Ve(e,t){const r=e.tilingScheme,i=[],n={},a=e._lodCount,s=O.Z.fromRadians(t.west,t.north),o=O.Z.fromRadians(t.east,t.south),l=r.positionToTileXY(s,a),c=r.positionToTileXY(o,a);for(let h=l.x;h<=c.x;h++)for(let t=l.y;t<=c.y;t++){const s=u.Z.fromElements(h,t,Me),o=s.toString();if(!n.hasOwnProperty(o)){const t={x:s.x,y:s.y,level:a,tilingScheme:r,terrainProvider:e,positions:[]};n[o]=t,i.push(t)}}const d=[];for(let u=0;u<i.length;++u){const e=i[u],t=e.terrainProvider.requestTileGeometry(e.x,e.y,e.level);d.push(t)}return Promise.all(d).then((function(e){const t=[];for(let n=0;n<e.length;n++){const a={tilingScheme:r,x:i[n].x,y:i[n].y,level:i[n].level},s=e[n];let o="Geographic";r._projection instanceof z.Z&&(o="WebMercator");const l={projectionType:o,projection:r._projection,nativeExtent:r.tileXYToNativeRectangle(a.x,a.y,a.level),height:s._height,width:s._width,scale:s._structure.heightScale,offset:s._structure.heightOffset};if(s._encoding===y.Z.LERC){const e=Se.decode(s._buffer);l.buffer=e.pixels[0]}else l.buffer=s._buffer;t.push(l)}return t}))}async function Be(e){const t=e._geoidTiledTerrainProvider;if((0,f.Z)(t))try{const r=await Ue(t,e._extent);e._geoidDataList=r}catch(r){console.log("Error retrieving Geoid Terrain tiles - no geoid conversion will be performed.")}else console.log("No Geoid Terrain service provided - no geoid conversion will be performed.")}Ae.prototype.loadGeoidData=async function(){return(0,f.Z)(this._geoidDataPromise)||(this._geoidDataPromise=Be(this)),this._geoidDataPromise},Ae.prototype._computeExtent=function(){let e;for(let t=0;t<this._layers.length;t++)if((0,f.Z)(this._layers[t]._extent)){const r=this._layers[t]._extent;(0,f.Z)(e)?w.Z.union(e,r,e):e=w.Z.clone(r)}this._extent=e};var Ce=Ae,Ee=(r(13226),{mounted(){this.init()},methods:{init(){const e=new s.Z("cesiumContainer",{terrainProvider:o.Z(),animation:!1,timeline:!1});l.Z.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio),e.scene.postProcessStages.fxaa.enabled=!0,e.scene.debugShowFramesPerSecond=!0;const t=new L({url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/EGM2008/ImageServer"}),r={},i={url:"https://tiles.arcgis.com/tiles/z2tnIkrLQ2BRzr6P/arcgis/rest/services/SanFrancisco_3DObjects_1_7/SceneServer/layers/0",traceFetches:!1,geoidTiledTerrainProvider:t,cesium3dTilesetOptions:r},n=new Ce(i);n.readyPromise.then((function(){const t=w.Z.center(n.extent);t.height=1e4,e.camera.setView({destination:g.Z.WGS84.cartographicToCartesian(t)})})),e.scene.primitives.add(n)}}}),Re=r(40089);const Fe=(0,Re.Z)(Ee,[["render",a],["__scopeId","data-v-81392638"]]);var Le=Fe}}]);
//# sourceMappingURL=4582.009637b5.js.map