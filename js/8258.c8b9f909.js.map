{"version":3,"file":"js/8258.c8b9f909.js","mappings":"iLACOA,GAAG,mB,0CAARC,EAAAA,EAAAA,IAAgC,MAAhCC,E,sIAOF,MAAMC,EACJC,YAAYC,GACVC,KAAKC,MAAQ,IAAIC,EAAAA,EAAwB,WACzCF,KAAKG,kBAAoB,GACzBH,KAAKI,iBAAcC,EACnBL,KAAKM,aAAUD,CACjB,CAKAE,WAAWC,GACJR,KAAKM,UACRN,KAAKM,QAAU,IAAIJ,EAAAA,EAA+BM,EAAOC,MAAMC,SAGjEV,KAAKM,QAAQK,gBAAgBC,IAC3B,MAAMC,EAAgBb,KAAKc,YAAYN,EAAQI,EAAMG,UACrD,GAAIb,EAAAA,EAAeW,GAAgB,CACjC,GAAsC,IAAlCb,KAAKG,kBAAkBa,OAAc,CACvChB,KAAKG,kBAAkBc,KAAKJ,GAC5B,MAAMK,EAAmB,IAAIhB,EAAAA,GAAwB,IAC5C,IAAIA,EAAAA,EAAwBF,KAAKG,qBACvC,GACHH,KAAKI,YAAcJ,KAAKmB,YAAYD,EACtC,CACAlB,KAAKG,kBAAkBc,KAAKJ,EAC9B,IACCX,EAAAA,EAAAA,YAEHF,KAAKM,QAAQK,gBAAgBS,IAC3B,GAAIpB,KAAKG,kBAAkBa,QAAU,EAAG,CACtC,MAAMH,EAAgBb,KAAKc,YAAYN,EAAQY,EAAKC,aAChDnB,EAAAA,EAAeW,KACjBb,KAAKG,kBAAkBmB,MACvBtB,KAAKG,kBAAkBc,KAAKJ,GAEhC,IACCX,EAAAA,EAAAA,YAEHF,KAAKM,QAAQK,gBAAgBC,IAC3BZ,KAAKG,kBAAkBmB,MACvBtB,KAAKC,MAAMsB,SAASC,OAAOxB,KAAKI,aAChCJ,KAAKmB,YAAYnB,KAAKG,mBACtBH,KAAKG,kBAAoB,EAAC,GACzBD,EAAAA,EAAAA,YACL,CAOAY,YAAYN,EAAQO,GAClB,IAAIF,EAEJ,GAAIL,EAAOiB,2BAA2BvB,EAAAA,EACpCW,EAAgBL,EAAOC,MAAMiB,OAAOC,cAAcZ,OAG/C,CACH,MAAMa,EAAMpB,EAAOkB,OAAOG,WAAWd,GACrCF,EAAgBL,EAAOC,MAAMqB,MAAMC,KAAKH,EAAKpB,EAAOC,MACtD,CACA,OAAOI,CACT,CAKAM,YAAYa,GACV,OAAOhC,KAAKC,MAAMsB,SAASU,IAAI,CAC7BC,QAAS,CACPC,UAAWH,EACXI,SAAU,IAAIlC,EAAAA,EACZA,EAAAA,EAAAA,MAAAA,UAA6B,OAIrC,CAKAmC,SAAS7B,GACPA,EAAO8B,YAAYL,IAAIjC,KAAKC,MAC9B,EAEF,OACEsC,UACEvC,KAAKwC,MACP,EACAC,QAAS,CACPD,OACE,MAAMhC,EAAS,IAAIN,EAAAA,EAAc,mBAC7BA,EAAAA,EAAAA,oCAEFM,EAAOkC,gBAAkBC,OAAOC,kBAElCpC,EAAOC,MAAMoC,kBAAkBC,KAAKC,SAAU,EAC9CvC,EAAOC,MAAMuC,0BAA2B,EAExC,MAAMC,EAAe,IAAIpD,EACzBoD,EAAa1C,WAAWC,GACxByC,EAAaZ,SAAS7B,EACxB,I,WC1GJ,MAAM0C,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://webgis/./src/components/public/draw_polygon.vue","webpack://webgis/./src/components/public/draw_polygon.vue?969d"],"sourcesContent":["<template>\n  <div id=\"cesiumContainer\"></div>\n</template>\n\n<script>\nimport 'cesium/Build/Cesium/Widgets/widgets.css'\nimport * as Cesium from 'cesium'\n\nclass DrawPolygons {\n  constructor(options) {\n    this.layer = new Cesium.CustomDataSource('MyLines')\n    this.activeShapePoints = []\n    this.activeShape = undefined\n    this.handler = undefined\n  }\n  /**\n   * 添加鼠标点击事件\n   * @param {Cesium.Viewer} viewer 目标地图\n   */\n  bindAction(viewer) {\n    if (!this.handler) {\n      this.handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);\n    }\n    // 鼠标左键单击画点\n    this.handler.setInputAction((click) => {\n      const earthPosition = this.getPosition(viewer, click.position)\n      if (Cesium.defined(earthPosition)) {\n        if (this.activeShapePoints.length === 0) {\n          this.activeShapePoints.push(earthPosition)\n          const dynamicPositions = new Cesium.CallbackProperty(() => {\n            return new Cesium.PolygonHierarchy(this.activeShapePoints);\n          }, false);\n          this.activeShape = this.drawPolygon(dynamicPositions)\n        }\n        this.activeShapePoints.push(earthPosition)\n      }\n    }, Cesium.ScreenSpaceEventType.LEFT_CLICK)\n    // 鼠标移动\n    this.handler.setInputAction((move) => {\n      if (this.activeShapePoints.length >= 2) {\n        const earthPosition = this.getPosition(viewer, move.endPosition)\n        if (Cesium.defined(earthPosition)) {\n          this.activeShapePoints.pop()\n          this.activeShapePoints.push(earthPosition)\n        }\n      }\n    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE)\n    // 单击鼠标右键结束画面\n    this.handler.setInputAction((click) => {\n      this.activeShapePoints.pop();\n      this.layer.entities.remove(this.activeShape)\n      this.drawPolygon(this.activeShapePoints)\n      this.activeShapePoints = []\n    }, Cesium.ScreenSpaceEventType.RIGHT_CLICK)\n  }\n  /**\n   * 添加鼠标点击事件的位置\n   * @param {Cesium.Viewer} viewer 目标地图\n   * @param {Cesium.Cartesian2} position 鼠标位置\n   * @return {Cesium.Cartesian3} 鼠标点击位置的坐标\n   */\n  getPosition(viewer, position) {\n    let earthPosition = undefined\n    // 球面\n    if (viewer.terrainProvider instanceof Cesium.EllipsoidTerrainProvider) {\n      earthPosition = viewer.scene.camera.pickEllipsoid(position);\n    }\n    // 地形\n    else {\n      const ray = viewer.camera.getPickRay(position);\n      earthPosition = viewer.scene.globe.pick(ray, viewer.scene);\n    }\n    return earthPosition\n  }\n  /**\n   * 画面\n   * @param {array<Cesium.Cartesian3>} positionData 面边界坐标\n   */\n  drawPolygon(positionData) {\n    return this.layer.entities.add({\n      polygon: {\n        hierarchy: positionData,\n        material: new Cesium.ColorMaterialProperty(\n          Cesium.Color.WHITE.withAlpha(0.7)\n        ),\n      },\n    });\n  }\n  /**\n   * 添加图层\n   * @param {Cesium.Viewer} viewer 目标地图\n   */\n  addToMap(viewer) {\n    viewer.dataSources.add(this.layer);\n  }\n}\nexport default {\n  mounted() {\n    this.init()\n  },\n  methods: {\n    init() {\n      const viewer = new Cesium.Viewer('cesiumContainer')\n      if (Cesium.FeatureDetection.supportsImageRenderingPixelated()) {\n        //判断是否支持图像渲染像素化处理\n        viewer.resolutionScale = window.devicePixelRatio\n      }\n      viewer.scene.postProcessStages.fxaa.enabled = true\n      viewer.scene.debugShowFramesPerSecond = true // 显示帧率\n\n      const drawPolygons = new DrawPolygons()\n      drawPolygons.bindAction(viewer)\n      drawPolygons.addToMap(viewer)\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n#cesiumContainer {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n}\n</style>\n","import { render } from \"./draw_polygon.vue?vue&type=template&id=29f61b6e&scoped=true\"\nimport script from \"./draw_polygon.vue?vue&type=script&lang=js\"\nexport * from \"./draw_polygon.vue?vue&type=script&lang=js\"\n\nimport \"./draw_polygon.vue?vue&type=style&index=0&id=29f61b6e&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhengjie/Documents/webgis/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-29f61b6e\"]])\n\nexport default __exports__"],"names":["id","_createElementBlock","_hoisted_1","DrawPolygons","constructor","options","this","layer","Cesium","activeShapePoints","activeShape","undefined","handler","bindAction","viewer","scene","canvas","setInputAction","click","earthPosition","getPosition","position","length","push","dynamicPositions","drawPolygon","move","endPosition","pop","entities","remove","terrainProvider","camera","pickEllipsoid","ray","getPickRay","globe","pick","positionData","add","polygon","hierarchy","material","addToMap","dataSources","mounted","init","methods","resolutionScale","window","devicePixelRatio","postProcessStages","fxaa","enabled","debugShowFramesPerSecond","drawPolygons","__exports__","render"],"sourceRoot":""}