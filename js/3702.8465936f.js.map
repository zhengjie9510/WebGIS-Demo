{"version":3,"file":"js/3702.8465936f.js","mappings":"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","sources":["webpack://webgis/./src/components/public/cesium_threejs.vue","webpack://webgis/./src/components/public/cesium_threejs.vue?87f1"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div id=\"cesiumContainer\"></div>\r\n    <canvas id=\"threeContainer\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n//\r\n<script>\r\nimport 'cesium/Build/Cesium/Widgets/widgets.css'\r\nimport {\r\n  Viewer,\r\n  ShadowMode,\r\n  Cartesian3,\r\n  Math as CesiumMath,\r\n  Color,\r\n} from 'cesium'\r\nimport * as THREE from 'three'\r\n\r\nconst cesium = {\r\n  viewer: null,\r\n}\r\nconst three = {\r\n  renderer: null,\r\n  camera: null,\r\n  scene: null,\r\n}\r\n// boundaries in WGS84 around the object\r\nlet minWGS84 = [115.23, 39.55]\r\nlet maxWGS84 = [116.23, 41.55]\r\n\r\nconst _3Dobjects = []\r\nfunction _3DObject() {\r\n  this.threeMesh = null //Three.js 3DObject.mesh\r\n  this.minWGS84 = null //location bounding box\r\n  this.maxWGS84 = null\r\n}\r\n\r\nexport default {\r\n  mounted() {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.initCesium()\r\n      this.initThreejs()\r\n      this.init3DObject()\r\n      this.startRenderLoop()\r\n    },\r\n    initCesium() {\r\n      cesium.viewer = new Viewer('cesiumContainer', {\r\n        useDefaultRenderLoop: false,\r\n        selectionIndicator: false,\r\n        infoBox: false,\r\n        navigationInstructionsInitiallyVisible: false,\r\n        fullscreenButton: false,\r\n        allowTextureFilterAnisotropic: false,\r\n        contextOptions: {\r\n          webgl: {\r\n            alpha: false,\r\n            antialias: true,\r\n            preserveDrawingBuffer: true,\r\n            failIfMajorPerformanceCaveat: false,\r\n            depth: true,\r\n            stencil: false,\r\n            anialias: false,\r\n          },\r\n        },\r\n        targetFrameRate: 60,\r\n        resolutionScale: 0.1,\r\n        orderIndependentTranslucency: true,\r\n        imageryProvider: undefined,\r\n        baseLayerPicker: false,\r\n        automaticallyTrackDataSourceClocks: false,\r\n        dataSources: null,\r\n        clock: null,\r\n        terrainShadows: ShadowMode.DISABLED,\r\n      })\r\n      const center = Cartesian3.fromDegrees(\r\n        (minWGS84[0] + maxWGS84[0]) / 2,\r\n        (minWGS84[1] + maxWGS84[1]) / 2 - 1,\r\n        200000\r\n      )\r\n      cesium.viewer.camera.flyTo({\r\n        destination: center,\r\n        orientation: {\r\n          heading: CesiumMath.toRadians(0),\r\n          pitch: CesiumMath.toRadians(-60),\r\n          roll: CesiumMath.toRadians(0),\r\n        },\r\n        duration: 3,\r\n      })\r\n    },\r\n    initThreejs() {\r\n      const canvas = document.querySelector('#threeContainer')\r\n      const renderer = new THREE.WebGLRenderer({\r\n        canvas: canvas,\r\n        alpha: true,\r\n        logarithmicDepthBuffer: true,\r\n        antialias: true,\r\n      })\r\n\r\n      var fov = 45\r\n      var width = canvas.clientWidth\r\n      var height = canvas.clientHeight\r\n      var aspect = width / height\r\n      var near = 1\r\n      var far = 10 * 1000 * 1000\r\n      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far)\r\n\r\n      const scene = new THREE.Scene()\r\n\r\n      three.renderer = renderer\r\n      three.scene = scene\r\n      three.camera = camera\r\n    },\r\n    init3DObject() {\r\n      // Cesium entity\r\n      const entity = {\r\n        name: 'Polygon',\r\n        polygon: {\r\n          hierarchy: Cartesian3.fromDegreesArray([\r\n            minWGS84[0],\r\n            minWGS84[1],\r\n            maxWGS84[0],\r\n            minWGS84[1],\r\n            maxWGS84[0],\r\n            maxWGS84[1],\r\n            minWGS84[0],\r\n            maxWGS84[1],\r\n          ]),\r\n          material: Color.RED.withAlpha(0.2),\r\n        },\r\n      }\r\n      cesium.viewer.entities.add(entity)\r\n      //Three.js Objects\r\n      /**\r\n       *  three的坐标系（右手坐标系），关键数据结构 Vector3\r\n       *    Y\r\n       *    |\r\n       *    |___ X\r\n       *   /\r\n       * Z\r\n       *\r\n       * Cesium的坐标系，关键数据结构 Cartesian3\r\n       *    Z\r\n       *    |\r\n       *    |__ Y\r\n       *   /\r\n       * X\r\n       *\r\n       */\r\n      // 在three的坐标系空间里，先向Z轴平移模型，然后绕X轴向上翻转90度，物体就面向Y轴了，对应Cesiumn的Z轴\r\n      // Lathe geometry\r\n      var doubleSideMaterial = new THREE.MeshNormalMaterial({\r\n        side: THREE.DoubleSide,\r\n      })\r\n      var segments = 10\r\n      var points = []\r\n      for (var i = 0; i < segments; i++) {\r\n        points.push(\r\n          new THREE.Vector2(Math.sin(i * 0.2) * segments + 5, (i - 5) * 2)\r\n        )\r\n      }\r\n      var geometry = new THREE.LatheGeometry(points)\r\n      var latheMesh = new THREE.Mesh(geometry, doubleSideMaterial)\r\n      latheMesh.scale.set(1500, 1500, 1500) //scale object to be visible at planet scale\r\n      latheMesh.position.z += 15000 // translate \"up\" in Three.js space so the \"bottom\" of the mesh is the handle\r\n      latheMesh.rotation.x = Math.PI / 2 // rotate mesh for Cesium's Y-up system\r\n      var latheMeshYup = new THREE.Group()\r\n      latheMeshYup.add(latheMesh)\r\n      three.scene.add(latheMeshYup) // don’t forget to add it to the Three.js scene manually\r\n\r\n      //Assign Three.js object mesh to our object array\r\n      var _3DOB = new _3DObject()\r\n      _3DOB.threeMesh = latheMeshYup\r\n      _3DOB.minWGS84 = minWGS84\r\n      _3DOB.maxWGS84 = maxWGS84\r\n      _3Dobjects.push(_3DOB)\r\n\r\n      // dodecahedron\r\n      geometry = new THREE.DodecahedronGeometry()\r\n      var dodecahedronMesh = new THREE.Mesh(\r\n        geometry,\r\n        new THREE.MeshNormalMaterial()\r\n      )\r\n      dodecahedronMesh.scale.set(10000, 10000, 10000) //scale object to be visible at planet scale\r\n      dodecahedronMesh.position.z += 10000 // translate \"up\" in Three.js space so the \"bottom\" of the mesh is the handle\r\n      dodecahedronMesh.rotation.x = Math.PI / 2 // rotate mesh for Cesium's Y-up system\r\n      var dodecahedronMeshYup = new THREE.Group()\r\n      dodecahedronMeshYup.add(dodecahedronMesh)\r\n      three.scene.add(dodecahedronMeshYup) // don’t forget to add it to the Three.js scene manually\r\n\r\n      //Assign Three.js object mesh to our object array\r\n      _3DOB = new _3DObject()\r\n      _3DOB.threeMesh = dodecahedronMeshYup\r\n      _3DOB.minWGS84 = minWGS84\r\n      _3DOB.maxWGS84 = maxWGS84\r\n      _3Dobjects.push(_3DOB)\r\n\r\n      // Configure Three.js meshes to stand against globe center position up direction\r\n      for (const id in _3Dobjects) {\r\n        minWGS84 = _3Dobjects[id].minWGS84\r\n        maxWGS84 = _3Dobjects[id].maxWGS84\r\n        // convert lat/long center position to Cartesian3\r\n        const center = Cartesian3.fromDegrees(\r\n          (minWGS84[0] + maxWGS84[0]) / 2,\r\n          (minWGS84[1] + maxWGS84[1]) / 2\r\n        )\r\n\r\n        // get forward direction for orienting model\r\n        const centerHigh = Cartesian3.fromDegrees(\r\n          (minWGS84[0] + maxWGS84[0]) / 2,\r\n          (minWGS84[1] + maxWGS84[1]) / 2,\r\n          1\r\n        )\r\n\r\n        // use direction from bottom left to top left as up-vector\r\n\r\n        // configure entity position and orientation\r\n        _3Dobjects[id].threeMesh.position.copy(center)\r\n        _3Dobjects[id].threeMesh.lookAt(\r\n          centerHigh.x,\r\n          centerHigh.y,\r\n          centerHigh.z\r\n        )\r\n      }\r\n    },\r\n    threeRender() {\r\n      // Clone Cesium Camera projection position so the\r\n      // Three.js Object will appear to be at the same place as above the Cesium Globe\r\n      three.camera.matrixAutoUpdate = false\r\n      const cvm = cesium.viewer.camera.viewMatrix\r\n      const civm = cesium.viewer.camera.inverseViewMatrix\r\n\r\n      three.camera.lookAt(0, 0, 0)\r\n      three.camera.matrixWorld.set(\r\n        civm[0],\r\n        civm[4],\r\n        civm[8],\r\n        civm[12],\r\n        civm[1],\r\n        civm[5],\r\n        civm[9],\r\n        civm[13],\r\n        civm[2],\r\n        civm[6],\r\n        civm[10],\r\n        civm[14],\r\n        civm[3],\r\n        civm[7],\r\n        civm[11],\r\n        civm[15]\r\n      )\r\n      three.camera.matrixWorldInverse.set(\r\n        cvm[0],\r\n        cvm[4],\r\n        cvm[8],\r\n        cvm[12],\r\n        cvm[1],\r\n        cvm[5],\r\n        cvm[9],\r\n        cvm[13],\r\n        cvm[2],\r\n        cvm[6],\r\n        cvm[10],\r\n        cvm[14],\r\n        cvm[3],\r\n        cvm[7],\r\n        cvm[11],\r\n        cvm[15]\r\n      )\r\n      const canvas = three.renderer.domElement\r\n      three.renderer.setPixelRatio(window.devicePixelRatio)\r\n      const width = canvas.clientWidth\r\n      const height = canvas.clientHeight\r\n      const needResize = canvas.width !== width || canvas.height !== height\r\n      if (needResize) {\r\n        three.renderer.setSize(width, height, false)\r\n      }\r\n      three.camera.aspect = width / height\r\n      three.camera.fov = CesiumMath.toDegrees(cesium.viewer.camera.frustum.fovy)\r\n      three.camera.updateProjectionMatrix()\r\n      three.renderer.render(three.scene, three.camera)\r\n    },\r\n    startRenderLoop() {\r\n      cesium.viewer.render()\r\n      this.threeRender()\r\n      requestAnimationFrame(this.startRenderLoop)\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n#cesiumContainer {\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n#threeContainer {\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  margin: 0%;\r\n  z-index: 10;\r\n  pointer-events: none;\r\n}\r\n</style>\r\n","import { render } from \"./cesium_threejs.vue?vue&type=template&id=4f41587c&scoped=true\"\nimport script from \"./cesium_threejs.vue?vue&type=script&lang=js\"\nexport * from \"./cesium_threejs.vue?vue&type=script&lang=js\"\n\nimport \"./cesium_threejs.vue?vue&type=style&index=0&id=4f41587c&lang=scss&scoped=true\"\n\nimport exportComponent from \"D:\\\\Documents\\\\GitHub\\\\webgis\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4f41587c\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","id","_hoisted_2","_hoisted_3","_createElementBlock","_hoisted_1","cesium","viewer","three","renderer","camera","scene","minWGS84","maxWGS84","_3Dobjects","_3DObject","this","threeMesh","mounted","init","methods","initCesium","initThreejs","init3DObject","startRenderLoop","Viewer","useDefaultRenderLoop","selectionIndicator","infoBox","navigationInstructionsInitiallyVisible","fullscreenButton","allowTextureFilterAnisotropic","contextOptions","webgl","alpha","antialias","preserveDrawingBuffer","failIfMajorPerformanceCaveat","depth","stencil","anialias","targetFrameRate","resolutionScale","orderIndependentTranslucency","imageryProvider","undefined","baseLayerPicker","automaticallyTrackDataSourceClocks","dataSources","clock","terrainShadows","ShadowMode","center","Cartesian3","flyTo","destination","orientation","heading","CesiumMath","pitch","roll","duration","canvas","document","querySelector","THREE","logarithmicDepthBuffer","fov","width","clientWidth","height","clientHeight","aspect","near","far","entity","name","polygon","hierarchy","material","Color","entities","add","doubleSideMaterial","side","segments","points","i","push","Math","sin","geometry","latheMesh","scale","set","position","z","rotation","x","PI","latheMeshYup","_3DOB","dodecahedronMesh","dodecahedronMeshYup","centerHigh","copy","lookAt","y","threeRender","matrixAutoUpdate","cvm","viewMatrix","civm","inverseViewMatrix","matrixWorld","matrixWorldInverse","domElement","setPixelRatio","window","devicePixelRatio","needResize","setSize","frustum","fovy","updateProjectionMatrix","render","requestAnimationFrame","__exports__"],"sourceRoot":""}